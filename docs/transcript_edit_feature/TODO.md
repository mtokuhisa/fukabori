# リアルタイム文字起こし編集機能 - 実装TODO

**最終更新**: 2025年7月24日  
**全体進捗**: 🔄 設計完了・実装待ち  

## 📋 **全体概要**

- **総推定工数**: 3-4日  
- **リスクレベル**: LOW（性能テスト合格済み）  
- **実装方針**: 段階的・安全優先・既存機能完全保護  

**📖 [設計詳細はREADME.md参照](README.md)**

---

## 🚀 **Phase A: 基本編集UI実装** 
**推定**: 1-2日 | **優先度**: HIGH | **ステータス**: ⏸ 未着手

### A1: TranscriptEditManager基盤作成
- [ ] **A1-1**: `app/transcript-edit-manager.js` ファイル新規作成
  - [ ] TranscriptEditManagerクラス基本構造
  - [ ] 編集状態管理プロパティ (`isEditing`, `originalText`)
  - [ ] 初期化・破棄メソッド
  - **担当**: 新チャットAI | **完了条件**: クラスインスタンス化可能

- [ ] **A1-2**: EditableTranscriptUI コンポーネント作成  
  - [ ] `app/editable-transcript-ui.js` ファイル新規作成
  - [ ] contenteditable制御メソッド (`enableEditing`, `disableEditing`)
  - [ ] 基本イベントハンドラー設定
  - **担当**: 新チャットAI | **完了条件**: DOM要素のcontenteditable切替可能

### A2: 既存システム統合
- [ ] **A2-1**: ui-basic.js 修正
  - [ ] `updateTranscriptDisplay()` 関数に編集中判定追加
  - [ ] 編集中は音声認識更新をスキップするロジック
  - **担当**: 新チャットAI | **完了条件**: 編集中に音声更新が停止

- [ ] **A2-2**: script.js 初期化統合
  - [ ] TranscriptEditManager インスタンス作成・初期化
  - [ ] DOMContentLoaded での自動セットアップ
  - **担当**: 新チャットAI | **完了条件**: ページ読み込み時に自動初期化

- [ ] **A2-3**: HTML読み込み追加
  - [ ] 深堀くん.html に新JSファイル2本の`<script>`タグ追加
  - [ ] キャッシュバスタ対応（`?v=0.7.6`等）
  - **担当**: 新チャットAI | **完了条件**: ブラウザで新ファイル読み込み確認

### A3: 基本編集機能テスト
- [ ] **A3-1**: 手動編集テスト
  - [ ] transcriptDisplay クリック → contenteditable有効化
  - [ ] テキスト編集 → 変更反映確認
  - [ ] 編集中の音声認識停止確認
  - **担当**: 新チャットAI | **完了条件**: 5回連続で正常動作

- [ ] **A3-2**: 回帰テスト実行
  - [ ] 既存 `tests/phase1-browser-test.html` 成功確認
  - [ ] 音声コマンドシステム動作確認
  - [ ] 一時停止ボタン動作確認
  - **担当**: 新チャットAI | **完了条件**: 全既存テスト合格

---

## ⏸️ **Phase B: 一時停止統合**
**推定**: 1日 | **優先度**: MEDIUM | **ステータス**: ⏸ Phase A完了後

### B1: 一時停止ボタン連携
- [ ] **B1-1**: 既存ボタン制御統合
  - [ ] `toggleMicrophone()` 関数との連携実装
  - [ ] 編集開始時の自動 Pause 実装
  - [ ] 編集完了時の自動 Resume 実装
  - **担当**: TBD | **完了条件**: 編集と一時停止の自動連動

- [ ] **B1-2**: 重複制御防止
  - [ ] ユーザー手動操作と自動操作の競合防止
  - [ ] ボタン状態表示の同期確保
  - **担当**: TBD | **完了条件**: 手動・自動操作で状態不整合なし

### B2: 統合テスト
- [ ] **B2-1**: 一時停止編集統合テスト
  - [ ] 編集開始→自動一時停止→編集完了→自動再開の一連フロー
  - [ ] 手動一時停止中の編集動作確認
  - **担当**: TBD | **完了条件**: 全パターンで正常動作

---

## 🔄 **Phase C: キーボード会話機能** (オプション)
**推定**: 1日 | **優先度**: LOW | **ステータス**: ⏸ 複雑性評価待ち

### C1: Enter送信機能
- [ ] **C1-1**: キーボードイベント処理
  - [ ] Enter キー押下での送信処理
  - [ ] Shift+Enter での改行処理
  - [ ] ESC キーでのキャンセル処理
  - **担当**: TBD | **完了条件**: キーボード操作で送信・キャンセル可能

- [ ] **C1-2**: handleUserTextInput統合
  - [ ] 既存 `handleUserTextInput()` 関数への連携
  - [ ] 音声入力と同等の処理フロー確保
  - **担当**: TBD | **完了条件**: キーボード入力でAI応答開始

### C2: 複雑性評価
- [ ] **C2-1**: 実装負荷評価
  - [ ] Phase A, B 完了後の複雑性評価
  - [ ] リスク・工数の再見積もり
  - **担当**: TBD | **完了条件**: 実装継続/スキップの判断

---

## ⚠️ **リスクヘッジ・品質保証**

### 🚨 緊急時対応
- [ ] **緊急無効化機能**: 単一フラグでの編集機能完全無効化
- [ ] **ロールバック準備**: 変更前ファイルのバックアップ作成
- [ ] **フォールバック確認**: 編集機能失敗時の既存表示復帰

### 🧪 継続テスト
- [ ] **性能監視**: contenteditable導入後の応答時間測定
- [ ] **メモリリーク監視**: 長時間使用でのメモリ使用量確認
- [ ] **ブラウザ互換性**: Chrome, Safari, Firefox での動作確認

---

## 📊 **進捗管理**

### 完了マーク説明
- ✅ **完了**: テスト合格・レビュー済み
- 🚧 **作業中**: 実装進行中
- ⏸ **未着手**: 実装待機中
- ❌ **ブロック**: 問題発生・対応必要

### マイルストーン
- **M1**: Phase A 完了 → 基本編集機能利用可能
- **M2**: Phase B 完了 → 一時停止統合完了・実用レベル達成
- **M3**: Phase C 完了 → キーボード会話対応・フル機能実現

---

## 🔄 **次チャット引き継ぎ情報**

### 開始時確認事項
1. **サーバー起動確認**: `python3 -m http.server 8000` 実行中か
2. **パフォーマンステスト**: 必要に応じて再実行可能 (`tests/performance-editable-test.html`)
3. **既存機能確認**: メインアプリ (`http://localhost:8000/深堀くん.html`) 正常動作確認

### 重要制約の再確認
- **既存機能の完全保護**: 動作中機能への破壊的変更絶対禁止
- **性能優先原則**: リアルタイム音声認識性能が最優先
- **段階的実装**: 各Phase完了後に動作確認してから次Phase移行

---

**📌 実装開始時は Phase A-1 から順番に実行してください**  
**🔗 詳細仕様: [README.md](README.md)** 