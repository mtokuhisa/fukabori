# SharePoint配布対応プロジェクト - 要件定義・TODO管理

**プロジェクト名**: 深堀くん SharePoint配布完全対応  
**作成日**: 2025年7月26日  
**バージョン**: v0.7.6対応  
**担当**: 新規チャット担当AI  

---

## 🎯 **プロジェクト概要**

### 目的
深堀くんv0.7.6をSharePoint環境で完全に動作させ、企業内配布を実現する。現在発生している技術的問題を全て解決し、ユーザーが「クリックするだけ」で利用できる状態にする。

### 背景
- 現在：`file://`プロトコルでは音声認識のマイク許可が毎回必要
- 目標：SharePoint（HTTPS）環境での配布により、マイク許可を1回のみに削減
- 課題：SharePointアップロード後に大量の404エラー・CSSエラーが発生中
- 期待効果：企業環境での大規模配布・運用の実現

---

## 🚨 **現在の問題状況（詳細分析済み）**

### 🔴 高優先度：アプリ動作を阻害
```
1. 大量の404エラー（30個以上）
   - 原因：HTMLファイルのパス参照とSharePointファイル配置の不一致
   - 影響：アプリが全く動かない状態

2. CSSファイルのMIME Typeエラー
   - 原因：SharePointがCSSファイルを正しく配信していない
   - 影響：見た目が完全に崩れる

3. テスト用ファイルの残存（重要）
   - 原因：HTMLに不要なテスト用スクリプトが残存
   - 影響：存在しないファイルへの参照で404エラー大量発生
```

### 🟡 中優先度：機能制限
```
4. Sandboxingエラー
   - 原因：SharePointがiframe内でスクリプト実行を制限
   - 影響：一部の動的機能が動作しない可能性

5. CORSポリシーエラー
   - 原因：PWA関連ファイルのクロスオリジン制限
   - 影響：PWAインストール機能が無効
```

### 🟢 低優先度：動作に影響しない
```
6. Service Worker競合・Microsoft UI Fabric警告
   - 影響：アプリ動作には影響なし（性能面・見た目の軽微な影響のみ）
```

---

## 📋 **技術要件・制約**

### SharePoint環境の制約
```
✅ 対応可能:
- HTTPS接続による音声認識（マイク許可1回のみ）
- 基本的なHTML/CSS/JavaScript実行
- LocalStorageによるデータ保存
- 静的ファイル配布

⚠️ 制約事項:
- CSSファイルのMIME Type制限
- iframe内での一部スクリプト制限
- CORSポリシーによるPWA機能制限
- 相対パス参照の必要性
```

### 現在のアプリ構成（v0.7.6）
```
主要機能:
✅ リアルタイム文字起こし編集機能（Phase A完了）
✅ 音声認識システム（透明継続システム）
✅ 統一状態管理システム
✅ 知見管理・AI対話システム

技術スタック:
- HTML/CSS/JavaScript（Pure）
- Web Speech API
- OpenAI API
- PWA対応（Service Worker）
```

---

## 🏗️ **実装計画（段階的アプローチ）**

### Phase 1: 基本動作復旧（優先度：最高）
**期間**: 1-2日  
**目標**: SharePointでアプリが正常に起動・動作する状態

```
1.1 HTMLファイルクリーンアップ
- テスト用スクリプト参照の完全削除
- 不要なファイル参照の整理

1.2 相対パス対応
- 全ファイル参照を相対パスに変更
- SharePoint環境での正しいパス構造確認

1.3 ファイル配置最適化
- 必要ファイルのみの配布パッケージ作成
- フォルダ構造の整理
```

### Phase 2: PWA機能改善（優先度：高）
**期間**: 1-2日  
**目標**: PWAインストール機能の復旧・最適化

```
2.1 manifest.json修正
- 相対パス対応（start_url, scope等）
- SharePoint環境向け最適化

2.2 Service Worker最適化
- SharePointとの競合回避
- キャッシュ戦略の調整

2.3 PWAインストールボタン対応
- SharePoint環境でのインストール動作確認
- フォールバック機能の実装
```

### Phase 3: 企業配布最適化（優先度：中）
**期間**: 1日  
**目標**: 企業環境での配布・運用最適化

```
3.1 配布手順書作成
- Step-by-Stepガイド
- 権限設定・セキュリティ考慮

3.2 エラーハンドリング強化
- SharePoint固有問題の対応
- ユーザーフレンドリーなエラーメッセージ

3.3 パフォーマンス最適化
- SharePoint環境での最適化
- 読み込み速度改善
```

---

## ✅ **TODO管理（優先度順）**

### 🔴 **Phase 1: 基本動作復旧**

#### **TODO 1-1: HTMLファイルクリーンアップ**
- [ ] **1-1-1**: `深堀くん.html`からテスト用スクリプト参照を削除
  ```html
  削除対象:
  - <script src="test-delete-fix.js"></script>
  - <script src="quick-test.js"></script>
  - <script src="voice-delete-integration-test.js"></script>
  - <script src="version-verification-test.js"></script>
  - その他テスト用ファイル参照
  ```
- [ ] **1-1-2**: 存在しないファイルへの参照を確認・削除
- [ ] **1-1-3**: コメントアウトされた不要コードの削除

#### **TODO 1-2: 相対パス対応**
- [ ] **1-2-1**: HTMLファイル内の全script/link/img参照を相対パスに変更
  ```html
  変更例:
  src="/app/script.js" → src="./app/script.js"
  href="/app/style.css" → href="./app/style.css"
  ```
- [ ] **1-2-2**: CSSファイル内の背景画像・フォント参照を相対パスに変更
- [ ] **1-2-3**: JavaScriptファイル内の動的パス参照を相対パスに変更

#### **TODO 1-3: ファイル配置最適化**
- [ ] **1-3-1**: 配布に必要なファイル一覧の確定
  ```
  必須ファイル:
  - 深堀くん.html（メインファイル）
  - app/フォルダ（25ファイル）
  - config/フォルダ（12ファイル）
  - assets/フォルダ（4ファイル）
  - manifest.json、sw.js、service-worker.js
  
  除外ファイル:
  - tests/フォルダ（全体）
  - backups/フォルダ（全体）
  - 開発用ファイル群
  ```
- [ ] **1-3-2**: SharePoint配布用ZIP作成スクリプト実装
- [ ] **1-3-3**: ファイル構成検証スクリプト実装

### 🟡 **Phase 2: PWA機能改善**

#### **TODO 2-1: manifest.json修正**
- [ ] **2-1-1**: start_url/scopeを相対パスに変更
  ```json
  "start_url": "/深堀くん.html" → "./深堀くん.html"
  "scope": "/" → "./"
  ```
- [ ] **2-1-2**: アイコンパスを相対パスに変更
- [ ] **2-1-3**: idを独自値に変更（SharePoint対応）

#### **TODO 2-2: Service Worker最適化**
- [ ] **2-2-1**: SharePointのService Workerとの競合を調査
- [ ] **2-2-2**: キャッシュ戦略をSharePoint環境向けに最適化
- [ ] **2-2-3**: Service Worker無効化時のフォールバック実装

#### **TODO 2-3: PWAインストール動作確認**
- [ ] **2-3-1**: SharePoint環境でのPWAインストールボタン表示確認
- [ ] **2-3-2**: インストール後の動作確認
- [ ] **2-3-3**: ブラウザ別対応状況確認

### 🟢 **Phase 3: 企業配布最適化**

#### **TODO 3-1: 配布手順書作成**
- [ ] **3-1-1**: SharePointアップロード手順の詳細化
- [ ] **3-1-2**: 権限設定・セキュリティ設定ガイド
- [ ] **3-1-3**: トラブルシューティングガイド

#### **TODO 3-2: エラーハンドリング強化**
- [ ] **3-2-1**: SharePoint固有エラーの検出・対応
- [ ] **3-2-2**: ユーザーフレンドリーなエラーメッセージ
- [ ] **3-2-3**: 自動復旧機能の実装

#### **TODO 3-3: パフォーマンス最適化**
- [ ] **3-3-1**: SharePoint環境での読み込み速度測定
- [ ] **3-3-2**: 不要なリソース読み込みの削減
- [ ] **3-3-3**: CDN対応検討

---

## 🔧 **実装ガイド**

### 開発環境設定
```bash
# ローカルテスト環境
python3 -m http.server 8000

# テストURL
http://localhost:8000/深堀くん.html

# SharePoint環境テスト
https://[your-sharepoint]/深堀くん/深堀くん.html
```

### ファイル修正時の注意事項
```
✅ 必須確認事項:
- バックアップ作成（backups/sharepoint_deployment_[date]/）
- 既存機能への影響確認
- v0.7.6リアルタイム編集機能の保護
- 音声認識システムの正常動作確認

❌ 禁止事項:
- コア機能の変更
- 大規模なリファクタリング
- 複数ファイルの同時変更
- テスト未実施での変更
```

---

## 📊 **成功基準**

### Phase 1完了基準
```
✅ SharePoint環境で深堀くんが正常に起動する
✅ 404エラーが0件になる
✅ CSSが正常に適用される
✅ 音声認識機能が動作する
✅ リアルタイム編集機能が動作する
```

### Phase 2完了基準
```
✅ PWAインストールボタンが表示される
✅ PWAとしてインストール可能
✅ Service Workerが正常動作する
✅ オフライン機能が利用可能
```

### Phase 3完了基準
```
✅ 企業環境での配布手順が確立
✅ ユーザーが「クリックするだけ」で利用可能
✅ トラブルシューティングが充実
✅ パフォーマンスが許容範囲内
```

---

## 🔗 **関連ドキュメント・リンク**

### 必読ドキュメント
- [デプロイメント・運用.md](./デプロイメント・運用.md) - SharePoint配布手順詳細
- [開発ガイドライン.md](./開発ガイドライン.md) - 開発時遵守ルール
- [技術仕様・依存関係.md](./技術仕様・依存関係.md) - システム構成詳細
- [深堀くん_設計仕様書.md](./深堀くん_設計仕様書.md) - UI/UX設計指針

### 重要な技術情報
- **現在のアプリバージョン**: v0.7.6
- **メイン機能**: リアルタイム文字起こし編集機能（Phase A完了）
- **ファイル構成**: 深堀くん.html（メイン） + app/（25ファイル） + config/（12ファイル）

### 過去の調査結果
- SharePoint配布エラー詳細分析：完了
- PWA対応状況調査：完了  
- 企業環境制約調査：完了
- 配布方式比較検討：完了

---

## ⚠️ **リスク評価・対策**

### 高リスク
```
リスク: コア機能への影響
対策: 段階的実装・完全バックアップ・回帰テスト

リスク: SharePoint固有制約の未発見
対策: 段階的テスト・早期フィードバック
```

### 中リスク  
```
リスク: PWA機能の完全復旧困難
対策: フォールバック機能・段階的対応

リスク: 企業環境での互換性問題
対策: 複数環境でのテスト・対応ガイド
```

### 低リスク
```
リスク: 性能劣化
対策: パフォーマンス監視・最適化

リスク: UI/UXの軽微な問題
対策: 継続的改善・ユーザーフィードバック
```

---

## 📝 **プロジェクト進捗管理**

### 全体進捗
- [ ] **Phase 1**: 基本動作復旧（0%）
- [ ] **Phase 2**: PWA機能改善（0%）  
- [ ] **Phase 3**: 企業配布最適化（0%）

### 今日の作業
**推奨開始**: TODO 1-1-1（HTMLファイルクリーンアップ）

### 完了報告フォーマット
```
## 作業完了報告

### 実施内容
- [完了したTODO]

### 確認事項
- [ ] ローカル環境での動作確認
- [ ] SharePoint環境での動作確認（可能であれば）
- [ ] 既存機能への影響確認

### 問題・懸念事項
- [発見した問題や懸念]

### 次回作業
- [次に実施すべきTODO]
```

---

**最終更新**: 2025年7月26日  
**次回更新**: 作業進捗に応じて随時  
**引き継ぎ完了**: ✅ 新規チャットでの作業開始準備完了 