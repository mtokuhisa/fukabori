REFACTORING_GUIDELINES

**🎯 リファクタリング目標**

重要事項を完全遵守:
✅ リファクタリング終了をユーザーから明示されるまで「デザイン・機能の完全保持」あくまでも内部構造だけを最適化する
✅ 完動状態の絶対死守
✅ 全バックアップの安全保持
✅ トラブル対応時は完動していたバックアップを参考にし、場当たり的にコードを作らない

## 🔥 **絶対遵守ルール（違反時は即座停止）**

### **Rule 0: 破壊的変更の絶対禁止**
```
❌ 絶対にやってはいけないこと:
- 動作している機能の削除・変更
- 大規模な一括変更
- バックアップ未確認での変更実行
- ユーザー確認なしの機能変更
- テスト未実施での変更実行
```

### **Rule 1: バックアップ確保の絶対原則**
```
✅ 変更前に必ず実行:
1. 現在の状態の完全バックアップ作成
2. バックアップからの復元テスト実施
3. 複数世代のバックアップ保持
4. バックアップ場所の明確化・記録
5. ユーザーによるバックアップ確認
```

### **Rule 2: 段階的変更の厳格実施**
```
✅ 変更の最小単位:
- 1回の変更: 最大50行まで
- 1つの機能のみ変更
- 影響範囲の事前分析必須
- 各段階での完全動作確認
- 問題発生時の即座巻き戻し準備
```

### **Rule 3: 動作確認の完璧実施**
```
✅ 各段階で必須の確認:
1. 全機能の動作テスト
2. UI表示の変更なし確認
3. パフォーマンス劣化なし確認
4. エラー・警告の発生なし確認
5. ユーザーによる動作確認
```

---

## 📋 **AI記憶対策（忘却防止システム）**

### **記憶補強メカニズム**
```
毎回のセッション開始時に必ず以下を確認:
1. 【このREFACTORING_GUIDELINES.md】の全内容
2. 【現在の動作状態】の完全把握
3. 【バックアップ状況】の確認
4. 【前回からの変更点】の詳細確認
```

### **AI自己チェックリスト**
```
変更実行前に必ず自問:
□ 現在の動作状態を完全に把握したか？
□ バックアップは確実に存在するか？
□ 変更が他の機能に影響を与えないか？
□ 影響範囲を完全に分析したか？
□ 復元手順を準備したか？
□ ユーザーの指示を正確に理解したか？
□ 「デザイン・機能を変えない」を守れるか？

1つでも「No」があれば変更を停止する
```

---

## 🎯 **リファクタリング実行プロトコル**

### **Phase 0: 事前準備（絶対必須）**
```
1. 現状分析・記録
   - 動作する機能のリスト作成
   - 現在のファイル構成記録
   - 依存関係の完全マップ作成
   - ユーザーによる動作確認

2. バックアップ作成
   - 全ファイルの完全コピー
   - 動作テスト済みバックアップ
   - 復元手順の文書化
   - ユーザーによるバックアップ確認

3. テスト環境準備
   - 本環境と同一のテスト環境
   - 自動テストスクリプト作成
   - 手動テスト手順書作成
```

### **Phase 1: 最小変更実行**
```
1. 変更計画
   - 変更理由: 明確化
   - 影響範囲: 完全分析
   - 復元手順: 準備完了

2. 変更実行
   - 1つずつ慎重に変更
   - 各行での動作確認
   - エラー発生時の即座停止
   - 完了後の全機能テスト

3. 動作確認
   - 全機能テスト実行
   - UI表示確認
   - パフォーマンス確認
   - ユーザーによる最終確認
```

### **Phase 2: 問題対応**
```
問題発生時の対応:
1. 即座に作業停止
2. バックアップからの完全復元
3. 問題の原因分析
4. 対策検討・計画修正
5. ユーザーへの報告・謝罪
```

---

## 📝 **文書化強化ルール**

### **変更記録の詳細化**
```
変更実行時に必ず記録:
- 変更日時・担当者
- 変更内容の詳細
- 変更理由・目的
- 影響範囲の分析
- テスト結果
- ユーザー確認結果
- 問題・改善点
```

### **状況レポート**
```
毎回のセッションで作成:
1. 現在の動作状況
2. 実行した変更内容
3. 発生した問題
4. 次回の計画
5. ユーザーへの報告事項
```

---

## 🚨 **緊急事態対応プロトコル**

### **重大問題発生時**
```
1. 即座実行事項:
   - 全作業の即座停止
   - 問題の影響範囲確認
   - バックアップからの復元準備
   - ユーザーへの緊急報告

2. 復旧作業:
   - バックアップからの完全復元
   - 動作確認テスト実行
   - ユーザーによる復旧確認
   - 問題の原因分析・記録

3. 再発防止:
   - 失敗原因の詳細分析
   - ルールの見直し・強化
   - 対策の実装・テスト
   - チーム内での共有・教育
```

---

## 🔒 **品質保証システム**

### **3段階チェック体制**
```
Level 1: AI自己チェック
- 変更前後の動作比較
- ルール遵守確認
- 影響範囲分析

Level 2: 自動テスト
- 全機能テスト実行
- パフォーマンステスト
- エラー検出テスト

Level 3: ユーザー確認
- 実際の使用感確認
- 機能・デザインの変更なし確認
- 満足度・問題点の確認
```

### **品質基準**
```
合格基準（全て満たす必要）:
□ 全機能が完全動作
□ UI・デザインに変更なし
□ パフォーマンス劣化なし
□ エラー・警告なし
□ ユーザー満足度維持・向上
□ 技術的負債の改善
```

---

## 📊 **進捗管理システム**

### **進捗の可視化**
```
毎日の進捗報告:
- 実行した作業内容
- 達成した改善点
- 発生した問題
- 次回の予定
- リスク・懸念事項

週次レビュー:
- 週間の成果まとめ
- 品質指標の測定
- ユーザーフィードバック
- 計画の見直し
```

---

## 🎯 **成功の定義**

### **技術的成功**
- コードの可読性向上
- 保守性の向上
- 拡張性の確保
- 技術的負債の削減

### **ユーザー体験成功**
- 機能・デザインの完全維持
- 動作の安定性向上
- 使用感の向上
- 信頼性の向上

### **プロジェクト成功**
- 予定通りの完了
- 品質目標の達成
- ユーザー満足度の向上
- チーム能力の向上

---

## ⚡ **緊急対応コマンド**

### **即座実行用コマンドリスト**
```bash
# 緊急バックアップ作成
cp -r . ../backup_$(date +%Y%m%d_%H%M%S)

# 動作確認テスト
python3 -m http.server 8000 --bind 127.0.0.1

# 変更差分確認
git diff --stat

# 復元実行
# バックアップから該当ファイルを復元
```

---

## 📚 **AI学習強化システム**

### **知識の定着**
```
毎セッション開始時:
1. このガイドラインの再読
2. 前回の失敗事例確認
3. 現在の状況把握
4. ユーザー要求の再確認
5. 今回の作業計画確認

毎作業前:
1. バックアップ状況確認
2. 変更影響範囲分析
3. 復元手順準備
4. ユーザー確認計画
```

### **継続的改善**
```
各作業後:
1. 実行内容の記録
2. 問題・改善点の記録
3. ルールの見直し検討
4. 次回の改善計画策定
```

---

## 🔥 **最重要原則（絶対遵守）**

### **鉄の掟**
```
1. 動作するものは絶対に壊すな
2. バックアップなしで変更するな
3. ユーザー確認なしで機能を変更するな
4. 大規模変更を一度に実行するな
5. 問題発生時は即座に停止・復元せよ
```

### **成功の条件**
```
成功 = 機能向上 + デザイン維持 + ユーザー満足
失敗 = 機能劣化 OR デザイン変更 OR ユーザー不満足
```

---

## 📞 **緊急連絡プロトコル**

### **重大問題発生時**
```
1. ユーザーへの即座報告
2. 問題の詳細説明
3. 復旧計画の提示
4. 謝罪と責任の明確化
5. 再発防止策の提示
```

---

**このガイドラインは、2025年7月5日の重大失敗を二度と繰り返さないために作成されました。**

**全てのAI開発者は、このルールを絶対に遵守し、ユーザーの信頼回復に努めなければなりません。**

---

**作成日**: 2025年7月5日  
**作成理由**: app.js破壊事件の再発防止  
**適用期間**: 永続  
**更新責任**: 全AI開発者  
**承認**: ユーザー（被害者） 