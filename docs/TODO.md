# 🔧 深堀くん リファクタリングTODO

**作成日**: 2025年1月11日  
**更新日**: 2025年1月11日

このドキュメントは、深堀くんのコード構造改善（リファクタリング）に関する項目を管理します。  
（機能改善・バグ修正はIMPROVEMENTS.mdを参照）

---

## 📋 リファクタリング項目

### **完了済み**
- [x] ユーティリティ関数の分離 (app/utils.js) - 64行削減
- [x] ファイル処理システムの分離 (app/file-processing.js) - 1,615行削減

### **進行中**
- [ ] app/script.js (10,974行) を機能別モジュールに分割

### **計画中**

#### **知見管理システムの分離**（優先度: 高）
- **対象**: `FukaboriKnowledgeDatabase`クラスと関連機能
- **推定行数**: 約600行（6%）
- **内容**: 
  - CSV処理機能
  - 知見データベース管理
  - AI強化機能
- **理由**: 独立性が高く、他のシステムへの依存が少ない

#### **音声制御システムの分離**（優先度: 中）
- **対象**: 音声関連の管理クラス群
- **推定行数**: 約400行（4%）
- **内容**:
  - `AudioControlManager`
  - `SmartVoicePanelManager`
  - `SpeechCorrectionSystem`
- **理由**: 明確な責務を持つ独立したシステム

#### **UI/DOM操作の統合**（優先度: 中）
- **対象**: DOM操作関連の関数
- **推定行数**: 約300行（3%）
- **内容**:
  - `DOMUtils`の拡張
  - UI更新関数の集約
  - イベントハンドラーの整理
- **理由**: 散在するDOM操作の一元化

#### **設定管理システムの分離**（優先度: 低）
- **対象**: 各種設定と状態管理
- **推定行数**: 約200行（2%）
- **内容**:
  - `AppState`の整理
  - `VoiceSettings`の分離
  - 設定の永続化処理
- **理由**: 設定管理の明確化

### **長期計画**

#### **TypeScript導入**
- **段階1**: 型定義ファイル(.d.ts)の作成
- **段階2**: 新規モジュールからTypeScript化
- **段階3**: 既存コードの段階的移行

#### **テストフレームワーク導入**
- **単体テスト**: Jest
- **統合テスト**: Playwright
- **音声機能**: モックテストの実装

#### **モジュールシステム**
- **ES6モジュール**への移行
- **依存関係**の明確化
- **循環依存**の解消

---

## 📊 進捗状況

**開始時**: 10,974行（app/script.js）  
**現在**: 9,359行（削減: 1,679行、15.3%）  
**目標**: 5,000行以下

### **削減実績**
1. ユーティリティ関数: 64行
2. ファイル処理システム: 1,615行
3. **合計**: 1,679行削減

---

## ⚠️ 注意事項

すべてのリファクタリング作業は以下のドキュメントに従って実施すること：
- `REFACTORING_GUIDELINES.md` - 基本ガイドライン
- `FUKABORI_REFACTORING_STRATEGY.md` - 詳細戦略

**中核システムは絶対に破壊しない**：
- VoiceKnowledgeSystem
- processDeepdiveUserResponse
- processKnowledgeWithVoiceEvaluation 