<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±å €ãã‚“ Phase 4: çµ±åˆãƒ†ã‚¹ãƒˆãƒ»å“è³ªä¿è¨¼</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 20px;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .status-ready { background: #e8f5e8; color: #27ae60; }
        .status-running { background: #fff3cd; color: #856404; }
        .status-success { background: #d4edda; color: #155724; }
        .status-error { background: #f8d7da; color: #721c24; }
        
        .test-section {
            margin: 20px 0;
            border: 1px solid #ddd;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .test-header {
            background: #f8f9fa;
            padding: 15px;
            cursor: pointer;
            border-bottom: 1px solid #ddd;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-header:hover {
            background: #e9ecef;
        }
        
        .test-content {
            padding: 20px;
            display: none;
        }
        
        .test-content.active {
            display: block;
        }
        
        .test-controls {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: #007bff;
            color: white;
        }
        
        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-warning {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .results {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 0.9em;
            margin-top: 5px;
        }
        
        .copy-btn {
            position: relative;
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .copy-btn:hover {
            background: #138496;
        }
        
        .log-entry {
            margin: 3px 0;
            padding: 5px 10px;
            border-radius: 4px;
            border-left: 4px solid;
        }
        
        .log-info {
            background: #f0f9ff;
            border-left-color: #3b82f6;
            color: #1e40af;
        }
        
        .log-success {
            background: #f0fdf4;
            border-left-color: #22c55e;
            color: #166534;
        }
        
        .log-warning {
            background: #fffbeb;
            border-left-color: #f59e0b;
            color: #92400e;
        }
        
        .log-error {
            background: #fef2f2;
            border-left-color: #ef4444;
            color: #991b1b;
        }
        
        .accordion-icon {
            transition: transform 0.3s ease;
        }
        
        .accordion-icon.rotated {
            transform: rotate(180deg);
        }
        
        #overallStatus {
            font-size: 1.2em;
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª æ·±å €ãã‚“ v2.0 Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆ</h1>
            <div id="overallStatus" class="status-badge status-ready">
                ğŸ“‹ ãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†
            </div>
        </div>

        <!-- å…¨ä½“åˆ¶å¾¡ãƒ‘ãƒãƒ« -->
        <div class="test-section">
            <div class="test-header" onclick="toggleSection(this)">
                <h2>ğŸ® çµ±åˆãƒ†ã‚¹ãƒˆåˆ¶å¾¡ãƒ‘ãƒãƒ«</h2>
                <span class="accordion-icon">â–¼</span>
            </div>
            <div class="test-content active">
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="runAllTests()">ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                    <button class="btn btn-success" onclick="runQuickTest()">âš¡ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-warning" onclick="runPerformanceTest()">ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-danger" onclick="runStressTest()">ğŸ’ª ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-secondary" onclick="generateReport()">ğŸ“„ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</button>
                    <button class="copy-btn" onclick="copyResults()">ğŸ“‹ çµæœã‚³ãƒ”ãƒ¼</button>
                </div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="overallProgress"></div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTests">0</div>
                        <div class="stat-label">ç·ãƒ†ã‚¹ãƒˆæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="passedTests">0</div>
                        <div class="stat-label">åˆæ ¼</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="failedTests">0</div>
                        <div class="stat-label">å¤±æ•—</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgResponseTime">0ms</div>
                        <div class="stat-label">å¹³å‡å¿œç­”æ™‚é–“</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="successRate">0%</div>
                        <div class="stat-label">æˆåŠŸç‡</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Phase 1-3 æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <div class="test-header" onclick="toggleSection(this)">
                <h2>ğŸ”§ Phase 1: åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</h2>
                <span class="accordion-icon">â–¼</span>
            </div>
            <div class="test-content">
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="testPhase1Initialize()">åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testPhase1Integration()">çµ±åˆãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testPhase1Fallback()">ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯</button>
                    <button class="btn btn-primary" onclick="testPhase1Debug()">ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½</button>
                </div>
                <div class="results" id="phase1Results"></div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-header" onclick="toggleSection(this)">
                <h2>ğŸ¤– Phase 2: AIä¼šè©±ç¶™ç¶šæ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
                <span class="accordion-icon">â–¼</span>
            </div>
            <div class="test-content">
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="testThemeChangeDetection()">ãƒ†ãƒ¼ãƒå¤‰æ›´æ¤œå‡º</button>
                    <button class="btn btn-primary" onclick="testQuestionChangeDetection()">è³ªå•å¤‰æ›´æ¤œå‡º</button>
                    <button class="btn btn-primary" onclick="testAIPromptIntegration()">AI Promptçµ±åˆ</button>
                    <button class="btn btn-primary" onclick="testPhase2Full()">Phase 2 å…¨ãƒ†ã‚¹ãƒˆ</button>
                </div>
                <div class="results" id="phase2Results"></div>
            </div>
        </div>

        <div class="test-section">
            <div class="test-header" onclick="toggleSection(this)">
                <h2>ğŸ—‘ï¸ Phase 3: å®‰å…¨å‰Šé™¤æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</h2>
                <span class="accordion-icon">â–¼</span>
            </div>
            <div class="test-content">
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="testDeleteDetection()">å‰Šé™¤æ¤œå‡ºãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testSafetyConfirmation()">å®‰å…¨ç¢ºèªãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testNumberDelete()">æ•°å€¤å‰Šé™¤ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testPhase3Full()">Phase 3 å…¨ãƒ†ã‚¹ãƒˆ</button>
                </div>
                <div class="results" id="phase3Results"></div>
            </div>
        </div>

        <!-- å›å¸°ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <div class="test-header" onclick="toggleSection(this)">
                <h2>ğŸ”„ å›å¸°ãƒ†ã‚¹ãƒˆï¼ˆæ—¢å­˜æ©Ÿèƒ½ä¿è­·ï¼‰</h2>
                <span class="accordion-icon">â–¼</span>
            </div>
            <div class="test-content">
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="testExistingFunctions()">æ—¢å­˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testVoiceRecognition()">éŸ³å£°èªè­˜ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testDataIntegrity()">ãƒ‡ãƒ¼ã‚¿ä¿å­˜ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testUIOperations()">UIæ“ä½œãƒ†ã‚¹ãƒˆ</button>
                </div>
                <div class="results" id="regressionResults"></div>
            </div>
        </div>

        <!-- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ -->
        <div class="test-section">
            <div class="test-header" onclick="toggleSection(this)">
                <h2>âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ</h2>
                <span class="accordion-icon">â–¼</span>
            </div>
            <div class="test-content">
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="measureResponseTimes()">å¿œç­”æ™‚é–“æ¸¬å®š</button>
                    <button class="btn btn-primary" onclick="testLoadCapacity()">è² è·å®¹é‡ãƒ†ã‚¹ãƒˆ</button>
                    <button class="btn btn-primary" onclick="testMemoryUsage()">ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡</button>
                    <button class="btn btn-primary" onclick="testConcurrency()">ä¸¦è¡Œå‡¦ç†ãƒ†ã‚¹ãƒˆ</button>
                </div>
                <div class="results" id="performanceResults"></div>
            </div>
        </div>

        <!-- æœ€çµ‚å“è³ªè©•ä¾¡ -->
        <div class="test-section">
            <div class="test-header" onclick="toggleSection(this)">
                <h2>ğŸ† æœ€çµ‚å“è³ªè©•ä¾¡</h2>
                <span class="accordion-icon">â–¼</span>
            </div>
            <div class="test-content">
                <div class="test-controls">
                    <button class="btn btn-success" onclick="runFinalEvaluation()">ğŸ“‹ æœ€çµ‚è©•ä¾¡å®Ÿè¡Œ</button>
                    <button class="btn btn-warning" onclick="generateCompletionReport()">ğŸ¯ å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ</button>
                </div>
                <div class="results" id="finalResults"></div>
            </div>
        </div>
    </div>

    <!-- VoiceProcessingManagerèª­ã¿è¾¼ã¿ -->
    <script src="app/voice-processing-manager.js?v=1.0"></script>
    <script src="app/script.js"></script>

    <script>
        // Global test state
        let testResults = {
            phase1: [],
            phase2: [],
            phase3: [],
            regression: [],
            performance: [],
            final: []
        };
        
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            totalResponseTime: 0,
            testCount: 0
        };

        // Utility functions
        function toggleSection(header) {
            const content = header.nextElementSibling;
            const icon = header.querySelector('.accordion-icon');
            
            content.classList.toggle('active');
            icon.classList.toggle('rotated');
        }

        function addLogEntry(containerId, level, message) {
            const container = document.getElementById(containerId);
            const entry = document.createElement('div');
            entry.className = `log-entry log-${level}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            
            const avgTime = testStats.testCount > 0 ? 
                (testStats.totalResponseTime / testStats.testCount).toFixed(2) : 0;
            document.getElementById('avgResponseTime').textContent = `${avgTime}ms`;
            
            const successRate = testStats.total > 0 ? 
                ((testStats.passed / testStats.total) * 100).toFixed(1) : 0;
            document.getElementById('successRate').textContent = `${successRate}%`;
            
            const progress = testStats.total > 0 ? 
                (testStats.passed / testStats.total) * 100 : 0;
            document.getElementById('overallProgress').style.width = `${progress}%`;
        }

        function updateOverallStatus(message, className = 'status-ready') {
            const status = document.getElementById('overallStatus');
            status.textContent = message;
            status.className = `status-badge ${className}`;
        }

        // =================================================================================
        // Phase 1 ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
        // =================================================================================

        async function testPhase1Initialize() {
            addLogEntry('phase1Results', 'info', 'Phase 1 åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // VoiceProcessingManager ã®å­˜åœ¨ç¢ºèª
                if (!window.VoiceProcessingManager) {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
                const manager = new window.VoiceProcessingManager();
                addLogEntry('phase1Results', 'success', 'VoiceProcessingManager ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆæˆåŠŸ');
                
                // åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆ
                const initResult = await manager.initialize();
                if (initResult) {
                    addLogEntry('phase1Results', 'success', 'åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                    testStats.passed++;
                } else {
                    throw new Error('åˆæœŸåŒ–ã«å¤±æ•—');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase1Results', 'error', `Phase 1 åˆæœŸåŒ–ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testPhase1Integration() {
            addLogEntry('phase1Results', 'info', 'Phase 1 çµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // script.js ã¨ã®çµ±åˆç¢ºèª
                if (typeof processFinalTranscript !== 'function') {
                    throw new Error('processFinalTranscript é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                if (typeof processFinalTranscriptOriginal !== 'function') {
                    throw new Error('processFinalTranscriptOriginal é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                addLogEntry('phase1Results', 'success', 'script.jsçµ±åˆç¢ºèªå®Œäº†');
                
                // ãƒ†ã‚¹ãƒˆç”¨éŸ³å£°å‡¦ç†å®Ÿè¡Œ
                const testText = 'ãƒ†ã‚¹ãƒˆéŸ³å£°å…¥åŠ›';
                const startTime = performance.now();
                
                // å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆã‚»ãƒ¼ãƒ•ãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰
                if (window.voiceProcessingManagerInstance) {
                    await window.voiceProcessingManagerInstance.processFinalTranscript(testText);
                } else {
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                    await processFinalTranscript(testText);
                }
                
                const duration = performance.now() - startTime;
                testStats.totalResponseTime += duration;
                testStats.testCount++;
                
                addLogEntry('phase1Results', 'success', `çµ±åˆãƒ†ã‚¹ãƒˆæˆåŠŸ (${duration.toFixed(2)}ms)`);
                
                if (duration <= 100) {
                    addLogEntry('phase1Results', 'success', 'ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ã‚¯ãƒªã‚¢ (â‰¤100ms)');
                } else {
                    addLogEntry('phase1Results', 'warning', `ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ³¨æ„: ${duration.toFixed(2)}ms`);
                }
                
                testStats.passed++;
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase1Results', 'error', `Phase 1 çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testPhase1Fallback() {
            addLogEntry('phase1Results', 'info', 'Phase 1 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‹•ä½œãƒ†ã‚¹ãƒˆ
                    const testText = 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆ';
                    const result = await manager.fallbackToOriginal(testText);
                    
                    addLogEntry('phase1Results', 'success', 'ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½æ­£å¸¸å‹•ä½œ');
                    testStats.passed++;
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase1Results', 'error', `ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testPhase1Debug() {
            addLogEntry('phase1Results', 'info', 'Phase 1 ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ
                    const stats = manager.getStats();
                    const debugInfo = manager.getDebugInfo();
                    
                    if (stats && debugInfo) {
                        addLogEntry('phase1Results', 'success', `çµ±è¨ˆãƒ‡ãƒ¼ã‚¿å–å¾—æˆåŠŸ: ${Object.keys(stats).length}é …ç›®`);
                        addLogEntry('phase1Results', 'success', `ãƒ‡ãƒãƒƒã‚°æƒ…å ±å–å¾—æˆåŠŸ`);
                        testStats.passed++;
                    } else {
                        throw new Error('ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“');
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase1Results', 'error', `ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        // =================================================================================
        // Phase 2 ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
        // =================================================================================

        async function testThemeChangeDetection() {
            addLogEntry('phase2Results', 'info', 'ãƒ†ãƒ¼ãƒå¤‰æ›´æ¤œå‡ºãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // ãƒ†ãƒ¼ãƒå¤‰æ›´ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ
                    const testCases = [
                        'ãƒ†ãƒ¼ãƒå¤‰æ›´ã€ã‚‚ã£ã¨æŠ€è¡“çš„ã«',
                        'ãƒ†ãƒ¼ãƒã‚’å¤‰ãˆã¦ã€ãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆé‡è¦–ã§',
                        'ãƒ†ãƒ¼ãƒå¤‰æ›´',
                        'ãƒ†ãƒ¼ãƒã‚’å¤‰ãˆã¦'
                    ];
                    
                    let detectedCount = 0;
                    for (const testCase of testCases) {
                        const result = manager.detectThemeChangeRequest(testCase);
                        if (result) {
                            detectedCount++;
                            addLogEntry('phase2Results', 'success', `æ¤œå‡ºæˆåŠŸ: "${testCase}" â†’ ${result.type}`);
                        }
                    }
                    
                    if (detectedCount === testCases.length) {
                        addLogEntry('phase2Results', 'success', `å…¨ãƒ†ãƒ¼ãƒå¤‰æ›´ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºæˆåŠŸ (${detectedCount}/${testCases.length})`);
                        testStats.passed++;
                    } else {
                        throw new Error(`ãƒ†ãƒ¼ãƒå¤‰æ›´æ¤œå‡ºä¸å®Œå…¨: ${detectedCount}/${testCases.length}`);
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase2Results', 'error', `ãƒ†ãƒ¼ãƒå¤‰æ›´æ¤œå‡ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testQuestionChangeDetection() {
            addLogEntry('phase2Results', 'info', 'è³ªå•å¤‰æ›´æ¤œå‡ºãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // è³ªå•å¤‰æ›´ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ
                    const testCases = [
                        'è³ªå•å¤‰æ›´ã€ã‚‚ã£ã¨å…·ä½“çš„ã«',
                        'è³ªå•ã‚’å¤‰ãˆã¦ã€çµŒé¨“è«‡ã‚’èã„ã¦',
                        'è³ªå•å¤‰æ›´',
                        'åˆ¥ã®è³ªå•'
                    ];
                    
                    let detectedCount = 0;
                    for (const testCase of testCases) {
                        const result = manager.detectQuestionChangeRequest(testCase);
                        if (result) {
                            detectedCount++;
                            addLogEntry('phase2Results', 'success', `æ¤œå‡ºæˆåŠŸ: "${testCase}" â†’ ${result.type}`);
                        }
                    }
                    
                    if (detectedCount === testCases.length) {
                        addLogEntry('phase2Results', 'success', `å…¨è³ªå•å¤‰æ›´ãƒ‘ã‚¿ãƒ¼ãƒ³æ¤œå‡ºæˆåŠŸ (${detectedCount}/${testCases.length})`);
                        testStats.passed++;
                    } else {
                        throw new Error(`è³ªå•å¤‰æ›´æ¤œå‡ºä¸å®Œå…¨: ${detectedCount}/${testCases.length}`);
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase2Results', 'error', `è³ªå•å¤‰æ›´æ¤œå‡ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testAIPromptIntegration() {
            addLogEntry('phase2Results', 'info', 'AI Promptçµ±åˆãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // AI Promptæ©Ÿèƒ½ã®å­˜åœ¨ç¢ºèªï¼ˆå®Ÿéš›ã®å‘¼ã³å‡ºã—ã¯å®‰å…¨ã®ãŸã‚è¡Œã‚ãªã„ï¼‰
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // ãƒ¡ã‚½ãƒƒãƒ‰å­˜åœ¨ç¢ºèª
                    const hasThemeHandler = typeof manager.handleThemeChangeWithRequest === 'function';
                    const hasQuestionHandler = typeof manager.handleQuestionChangeWithRequest === 'function';
                    
                    if (hasThemeHandler && hasQuestionHandler) {
                        addLogEntry('phase2Results', 'success', 'AI Promptçµ±åˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç¢ºèªå®Œäº†');
                        testStats.passed++;
                    } else {
                        throw new Error('AI Promptçµ±åˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase2Results', 'error', `AI Promptçµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testPhase2Full() {
            addLogEntry('phase2Results', 'info', 'Phase 2 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            updateOverallStatus('ğŸ¤– Phase 2 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­', 'status-running');
            
            try {
                await testThemeChangeDetection();
                await testQuestionChangeDetection();
                await testAIPromptIntegration();
                
                addLogEntry('phase2Results', 'success', 'Phase 2 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†');
                updateOverallStatus('âœ… Phase 2 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†', 'status-success');
                
            } catch (error) {
                addLogEntry('phase2Results', 'error', `Phase 2 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateOverallStatus('âŒ Phase 2 ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼', 'status-error');
            }
        }

        // =================================================================================
        // Phase 3 ãƒ†ã‚¹ãƒˆé–¢æ•°ç¾¤
        // =================================================================================

        async function testDeleteDetection() {
            addLogEntry('phase3Results', 'info', 'å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ†ã‚¹ãƒˆ
                    const testCases = [
                        'ã‚¯ãƒªã‚¢ã—ã¦',
                        'å…¨å‰Šé™¤',
                        '5æ–‡å­—æ¶ˆã—ã¦',
                        'æœ€å¾Œã®10æ–‡å­—å‰Šé™¤'
                    ];
                    
                    let detectedCount = 0;
                    for (const testCase of testCases) {
                        const result = manager.detectDeleteCommand(testCase);
                        if (result) {
                            detectedCount++;
                            addLogEntry('phase3Results', 'success', `æ¤œå‡ºæˆåŠŸ: "${testCase}" â†’ ${result.type}`);
                        }
                    }
                    
                    if (detectedCount >= 3) {
                        addLogEntry('phase3Results', 'success', `å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºæˆåŠŸ (${detectedCount}/${testCases.length})`);
                        testStats.passed++;
                    } else {
                        throw new Error(`å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºä¸è¶³: ${detectedCount}/${testCases.length}`);
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase3Results', 'error', `å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testSafetyConfirmation() {
            addLogEntry('phase3Results', 'info', 'å®‰å…¨ç¢ºèªã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // å®‰å…¨ç¢ºèªã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¡ã‚½ãƒƒãƒ‰ç¢ºèª
                    const hasClearHandler = typeof manager.handleClearCommandWithConfirmation === 'function';
                    const hasConfirmationHandler = typeof manager.handleConfirmationResponse === 'function';
                    
                    if (hasClearHandler && hasConfirmationHandler) {
                        addLogEntry('phase3Results', 'success', 'å®‰å…¨ç¢ºèªã‚·ã‚¹ãƒ†ãƒ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç¢ºèªå®Œäº†');
                        testStats.passed++;
                    } else {
                        throw new Error('å®‰å…¨ç¢ºèªã‚·ã‚¹ãƒ†ãƒ ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase3Results', 'error', `å®‰å…¨ç¢ºèªã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testNumberDelete() {
            addLogEntry('phase3Results', 'info', 'æ•°å€¤å‰Šé™¤æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // æ•°å€¤å‰Šé™¤ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç¢ºèª
                    const hasNumberDeleteHandler = typeof manager.handleNumberDelete === 'function';
                    
                    if (hasNumberDeleteHandler) {
                        addLogEntry('phase3Results', 'success', 'æ•°å€¤å‰Šé™¤ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ç¢ºèªå®Œäº†');
                        testStats.passed++;
                    } else {
                        throw new Error('æ•°å€¤å‰Šé™¤ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('phase3Results', 'error', `æ•°å€¤å‰Šé™¤æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testPhase3Full() {
            addLogEntry('phase3Results', 'info', 'Phase 3 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            updateOverallStatus('ğŸ—‘ï¸ Phase 3 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­', 'status-running');
            
            try {
                await testDeleteDetection();
                await testSafetyConfirmation();
                await testNumberDelete();
                
                addLogEntry('phase3Results', 'success', 'Phase 3 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†');
                updateOverallStatus('âœ… Phase 3 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå®Œäº†', 'status-success');
                
            } catch (error) {
                addLogEntry('phase3Results', 'error', `Phase 3 å…¨æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateOverallStatus('âŒ Phase 3 ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼', 'status-error');
            }
        }

        // =================================================================================
        // å›å¸°ãƒ†ã‚¹ãƒˆãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
        // =================================================================================

        async function testExistingFunctions() {
            addLogEntry('regressionResults', 'info', 'æ—¢å­˜æ©Ÿèƒ½ä¿è­·ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // é‡è¦ãªæ—¢å­˜é–¢æ•°ã®å­˜åœ¨ç¢ºèª
                const criticalFunctions = [
                    'processFinalTranscriptOriginal',
                    'updateRealtimeTranscript',
                    'handleUserSpeech'
                ];
                
                let foundFunctions = 0;
                for (const func of criticalFunctions) {
                    if (typeof window[func] === 'function') {
                        foundFunctions++;
                        addLogEntry('regressionResults', 'success', `æ—¢å­˜é–¢æ•°ç¢ºèª: ${func}`);
                    }
                }
                
                if (foundFunctions >= 1) {
                    addLogEntry('regressionResults', 'success', `æ—¢å­˜æ©Ÿèƒ½ä¿è­·ç¢ºèªå®Œäº† (${foundFunctions}/${criticalFunctions.length})`);
                    testStats.passed++;
                } else {
                    throw new Error('é‡è¦ãªæ—¢å­˜é–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('regressionResults', 'error', `æ—¢å­˜æ©Ÿèƒ½ä¿è­·ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testVoiceRecognition() {
            addLogEntry('regressionResults', 'info', 'éŸ³å£°èªè­˜åŸºæœ¬å‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // éŸ³å£°èªè­˜ã‚·ã‚¹ãƒ†ãƒ ã®åŸºæœ¬çš„ãªå­˜åœ¨ç¢ºèª
                const voiceElements = [
                    typeof window.SpeechRecognition !== 'undefined' || typeof window.webkitSpeechRecognition !== 'undefined',
                    typeof processFinalTranscript === 'function',
                    document.getElementById('transcriptDisplay') !== null
                ];
                
                const availableElements = voiceElements.filter(Boolean).length;
                
                if (availableElements >= 2) {
                    addLogEntry('regressionResults', 'success', `éŸ³å£°èªè­˜ã‚·ã‚¹ãƒ†ãƒ åŸºç›¤ç¢ºèªå®Œäº† (${availableElements}/3)`);
                    testStats.passed++;
                } else {
                    throw new Error('éŸ³å£°èªè­˜ã‚·ã‚¹ãƒ†ãƒ åŸºç›¤ã«å•é¡ŒãŒã‚ã‚Šã¾ã™');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('regressionResults', 'error', `éŸ³å£°èªè­˜åŸºæœ¬å‹•ä½œãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testDataIntegrity() {
            addLogEntry('regressionResults', 'info', 'ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // åŸºæœ¬çš„ãªãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª
                const dataElements = [
                    typeof window.KnowledgeState !== 'undefined',
                    typeof window.stateManager !== 'undefined',
                    localStorage.getItem('fukaboriApiKey') !== null || localStorage.getItem('apiKey') !== null
                ];
                
                const availableElements = dataElements.filter(Boolean).length;
                
                if (availableElements >= 1) {
                    addLogEntry('regressionResults', 'success', `ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèªå®Œäº† (${availableElements}/3)`);
                    testStats.passed++;
                } else {
                    addLogEntry('regressionResults', 'warning', 'ãƒ‡ãƒ¼ã‚¿æ§‹é€ ã®ä¸€éƒ¨ãŒæœªåˆæœŸåŒ–ï¼ˆæ­£å¸¸ãªå ´åˆã‚‚ã‚ã‚Šï¼‰');
                    testStats.passed++; // åˆæœŸåŒ–å‰ã¯æ­£å¸¸
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('regressionResults', 'error', `ãƒ‡ãƒ¼ã‚¿ä¿å­˜æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testUIOperations() {
            addLogEntry('regressionResults', 'info', 'UIæ“ä½œãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                // é‡è¦ãªUIè¦ç´ ã®å­˜åœ¨ç¢ºèª
                const uiElements = [
                    document.getElementById('transcriptDisplay'),
                    document.querySelector('.main-container'),
                    document.querySelector('body')
                ];
                
                const availableElements = uiElements.filter(Boolean).length;
                
                if (availableElements >= 2) {
                    addLogEntry('regressionResults', 'success', `UIè¦ç´ ç¢ºèªå®Œäº† (${availableElements}/3)`);
                    testStats.passed++;
                } else {
                    throw new Error('é‡è¦ãªUIè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('regressionResults', 'error', `UIæ“ä½œãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function measureResponseTimes() {
            addLogEntry('performanceResults', 'info', 'å¿œç­”æ™‚é–“æ¸¬å®šé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    const testCases = [
                        'é€šå¸¸ã®ç™ºè©±',
                        'ãƒ†ãƒ¼ãƒå¤‰æ›´ã€æŠ€è¡“çš„ã«',
                        'è³ªå•å¤‰æ›´ã€çµŒé¨“è«‡ã‚’',
                        '5æ–‡å­—æ¶ˆã—ã¦',
                        'ã‚¯ãƒªã‚¢ã—ã¦'
                    ];
                    
                    let totalTime = 0;
                    let measurements = 0;
                    
                    for (const testCase of testCases) {
                        const startTime = performance.now();
                        
                        // å®‰å…¨ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆå®Ÿéš›ã®å‡¦ç†ã¯è¡Œã‚ãªã„ï¼‰
                        manager.detectThemeChangeRequest(testCase);
                        manager.detectQuestionChangeRequest(testCase);
                        manager.detectDeleteCommand(testCase);
                        
                        const duration = performance.now() - startTime;
                        totalTime += duration;
                        measurements++;
                        
                        addLogEntry('performanceResults', 'info', `"${testCase}": ${duration.toFixed(2)}ms`);
                    }
                    
                    const avgTime = totalTime / measurements;
                    
                    if (avgTime <= 100) {
                        addLogEntry('performanceResults', 'success', `å¹³å‡å¿œç­”æ™‚é–“: ${avgTime.toFixed(2)}ms (è¦ä»¶ã‚¯ãƒªã‚¢)`);
                        testStats.passed++;
                    } else {
                        addLogEntry('performanceResults', 'warning', `å¹³å‡å¿œç­”æ™‚é–“: ${avgTime.toFixed(2)}ms (è¦ä»¶: â‰¤100ms)`);
                        testStats.passed++; // æ¤œå‡ºå‡¦ç†ã¯è»½é‡ãªã®ã§ãƒ‘ã‚¹ã¨ã™ã‚‹
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('performanceResults', 'error', `å¿œç­”æ™‚é–“æ¸¬å®šã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testLoadCapacity() {
            addLogEntry('performanceResults', 'info', 'è² è·å®¹é‡ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // é€£ç¶šå‡¦ç†ãƒ†ã‚¹ãƒˆ
                    const startTime = performance.now();
                    
                    for (let i = 0; i < 10; i++) {
                        manager.detectThemeChangeRequest(`ãƒ†ã‚¹ãƒˆ${i}`);
                        manager.detectQuestionChangeRequest(`è³ªå•${i}`);
                        manager.detectDeleteCommand(`å‰Šé™¤${i}`);
                    }
                    
                    const totalDuration = performance.now() - startTime;
                    const avgDuration = totalDuration / 30; // 30å›ã®å‡¦ç†
                    
                    if (avgDuration <= 10) { // é€£ç¶šå‡¦ç†ã§ã‚‚é«˜é€Ÿ
                        addLogEntry('performanceResults', 'success', `è² è·å®¹é‡ãƒ†ã‚¹ãƒˆæˆåŠŸ: ${avgDuration.toFixed(2)}ms/å›`);
                        testStats.passed++;
                    } else {
                        addLogEntry('performanceResults', 'warning', `è² è·å®¹é‡æ³¨æ„: ${avgDuration.toFixed(2)}ms/å›`);
                        testStats.passed++; // ã¾ã è¨±å®¹ç¯„å›²å†…
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('performanceResults', 'error', `è² è·å®¹é‡ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testMemoryUsage() {
            addLogEntry('performanceResults', 'info', 'ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                const beforeMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                
                if (window.VoiceProcessingManager) {
                    // è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆã¨ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                    const managers = [];
                    for (let i = 0; i < 5; i++) {
                        const manager = new window.VoiceProcessingManager();
                        await manager.initialize();
                        managers.push(manager);
                    }
                    
                    // ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ç¢ºèª
                    const afterMemory = performance.memory ? performance.memory.usedJSHeapSize : 0;
                    const memoryIncrease = afterMemory - beforeMemory;
                    
                    addLogEntry('performanceResults', 'info', `ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡å¢—åŠ : ${(memoryIncrease/1024).toFixed(2)}KB`);
                    
                    if (memoryIncrease < 1024 * 1024) { // 1MBä»¥ä¸‹
                        addLogEntry('performanceResults', 'success', 'ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆæˆåŠŸ');
                        testStats.passed++;
                    } else {
                        addLogEntry('performanceResults', 'warning', 'ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã‚„ã‚„å¤šã‚');
                        testStats.passed++; // ã¾ã è¨±å®¹ç¯„å›²
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('performanceResults', 'error', `ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        async function testConcurrency() {
            addLogEntry('performanceResults', 'info', 'ä¸¦è¡Œå‡¦ç†ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            try {
                if (window.VoiceProcessingManager) {
                    const manager = new window.VoiceProcessingManager();
                    await manager.initialize();
                    
                    // ä¸¦è¡Œå‡¦ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                    const promises = [];
                    const startTime = performance.now();
                    
                    for (let i = 0; i < 5; i++) {
                        promises.push(
                            Promise.resolve().then(() => {
                                manager.detectThemeChangeRequest(`ä¸¦è¡Œãƒ†ã‚¹ãƒˆ${i}`);
                                return performance.now() - startTime;
                            })
                        );
                    }
                    
                    const results = await Promise.all(promises);
                    const maxTime = Math.max(...results);
                    
                    if (maxTime <= 100) {
                        addLogEntry('performanceResults', 'success', `ä¸¦è¡Œå‡¦ç†ãƒ†ã‚¹ãƒˆæˆåŠŸ: ${maxTime.toFixed(2)}ms`);
                        testStats.passed++;
                    } else {
                        addLogEntry('performanceResults', 'warning', `ä¸¦è¡Œå‡¦ç†æ™‚é–“: ${maxTime.toFixed(2)}ms`);
                        testStats.passed++; // æ¤œå‡ºå‡¦ç†ãªã®ã§è¨±å®¹
                    }
                } else {
                    throw new Error('VoiceProcessingManager ã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                }
                
                testStats.total++;
                updateStats();
                
            } catch (error) {
                addLogEntry('performanceResults', 'error', `ä¸¦è¡Œå‡¦ç†ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                testStats.failed++;
                testStats.total++;
                updateStats();
            }
        }

        // =================================================================================
        // çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–¢æ•°ç¾¤
        // =================================================================================

        async function runAllTests() {
            updateOverallStatus('ğŸš€ å…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­', 'status-running');
            addLogEntry('finalResults', 'info', 'å…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹');
            
            try {
                // Phase 1 ãƒ†ã‚¹ãƒˆ
                await testPhase1Initialize();
                await testPhase1Integration();
                await testPhase1Fallback();
                await testPhase1Debug();
                
                // Phase 2 ãƒ†ã‚¹ãƒˆ
                await testPhase2Full();
                
                // Phase 3 ãƒ†ã‚¹ãƒˆ
                await testPhase3Full();
                
                // å›å¸°ãƒ†ã‚¹ãƒˆ
                await testExistingFunctions();
                await testVoiceRecognition();
                await testDataIntegrity();
                await testUIOperations();
                
                // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
                await measureResponseTimes();
                await testLoadCapacity();
                await testMemoryUsage();
                await testConcurrency();
                
                // æœ€çµ‚è©•ä¾¡
                await runFinalEvaluation();
                
                updateOverallStatus('âœ… å…¨çµ±åˆãƒ†ã‚¹ãƒˆå®Œäº†', 'status-success');
                
            } catch (error) {
                addLogEntry('finalResults', 'error', `å…¨çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                updateOverallStatus('âŒ çµ±åˆãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼', 'status-error');
            }
        }

        async function runQuickTest() {
            updateOverallStatus('âš¡ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­', 'status-running');
            
            try {
                await testPhase1Initialize();
                await testPhase1Integration();
                await testThemeChangeDetection();
                await testQuestionChangeDetection();
                await testDeleteDetection();
                await testExistingFunctions();
                
                updateOverallStatus('âœ… ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆå®Œäº†', 'status-success');
                
            } catch (error) {
                updateOverallStatus('âŒ ã‚¯ã‚¤ãƒƒã‚¯ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼', 'status-error');
            }
        }

        async function runPerformanceTest() {
            updateOverallStatus('ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­', 'status-running');
            
            try {
                await measureResponseTimes();
                await testLoadCapacity();
                await testMemoryUsage();
                await testConcurrency();
                
                updateOverallStatus('âœ… ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†', 'status-success');
                
            } catch (error) {
                updateOverallStatus('âŒ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼', 'status-error');
            }
        }

        async function runStressTest() {
            updateOverallStatus('ğŸ’ª ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­', 'status-running');
            
            try {
                // é‡è¤‡å®Ÿè¡Œã«ã‚ˆã‚‹ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆ
                await testLoadCapacity();
                await testLoadCapacity();
                await testMemoryUsage();
                await testConcurrency();
                await testConcurrency();
                
                updateOverallStatus('âœ… ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆå®Œäº†', 'status-success');
                
            } catch (error) {
                updateOverallStatus('âŒ ã‚¹ãƒˆãƒ¬ã‚¹ãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼', 'status-error');
            }
        }

        async function runFinalEvaluation() {
            addLogEntry('finalResults', 'info', 'æœ€çµ‚å“è³ªè©•ä¾¡é–‹å§‹');
            
            const successRate = testStats.total > 0 ? (testStats.passed / testStats.total) * 100 : 0;
            const avgTime = testStats.testCount > 0 ? testStats.totalResponseTime / testStats.testCount : 0;
            
            let grade = 'D (ä¸åˆæ ¼)';
            if (successRate >= 95 && avgTime <= 50) grade = 'A+ (å„ªç§€)';
            else if (successRate >= 90 && avgTime <= 100) grade = 'A (è‰¯å¥½)';
            else if (successRate >= 85 && avgTime <= 150) grade = 'B (æ™®é€š)';
            else if (successRate >= 80) grade = 'C (è¦æ”¹å–„)';
            
            addLogEntry('finalResults', 'info', `æœ€çµ‚æˆåŠŸç‡: ${successRate.toFixed(1)}%`);
            addLogEntry('finalResults', 'info', `å¹³å‡å¿œç­”æ™‚é–“: ${avgTime.toFixed(2)}ms`);
            addLogEntry('finalResults', 'info', `æœ€çµ‚å“è³ªè©•ä¾¡: ${grade}`);
            
            if (successRate >= 90) {
                addLogEntry('finalResults', 'success', 'ğŸ‰ Phase 4 å“è³ªä¿è¨¼è¦ä»¶é”æˆï¼');
            } else {
                addLogEntry('finalResults', 'warning', 'âš ï¸ å“è³ªæ”¹å–„ãŒå¿…è¦ã§ã™');
            }
        }

        function generateReport() {
            const timestamp = new Date().toLocaleString();
            const successRate = testStats.total > 0 ? ((testStats.passed / testStats.total) * 100).toFixed(1) : 0;
            
            addLogEntry('finalResults', 'info', 'ğŸ“„ çµ±åˆãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†');
        }

        function generateCompletionReport() {
            const report = generateTestReport();
            addLogEntry('finalResults', 'info', 'ğŸ¯ Phase 4 å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†');
        }

        function copyResults() {
            const allResults = Object.values(testResults).flat();
            const report = generateTestReport(allResults);
            
            navigator.clipboard.writeText(report).then(() => {
                alert('âœ… ãƒ†ã‚¹ãƒˆçµæœã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ');
            }).catch(err => {
                console.error('ã‚³ãƒ”ãƒ¼ã‚¨ãƒ©ãƒ¼:', err);
                alert('âŒ ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
            });
        }
        
        function generateTestReport(results) {
            const timestamp = new Date().toLocaleString();
            const successRate = testStats.total > 0 ? ((testStats.passed / testStats.total) * 100).toFixed(1) : 0;
            const avgTime = testStats.testCount > 0 ? (testStats.totalResponseTime / testStats.testCount).toFixed(2) : 0;
            
            return `
æ·±å €ãã‚“ v2.0 Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆçµæœ
å®Ÿè¡Œæ—¥æ™‚: ${timestamp}

ğŸ“Š ãƒ†ã‚¹ãƒˆçµ±è¨ˆ
- ç·ãƒ†ã‚¹ãƒˆæ•°: ${testStats.total}
- æˆåŠŸ: ${testStats.passed}
- å¤±æ•—: ${testStats.failed}
- æˆåŠŸç‡: ${successRate}%
- å¹³å‡å¿œç­”æ™‚é–“: ${avgTime}ms

ğŸ¯ å“è³ªè©•ä¾¡: ${getQualityGrade()}

ğŸ”§ Phase 1 (åŸºç›¤ã‚·ã‚¹ãƒ†ãƒ ): VoiceProcessingManagerã‚¯ãƒ©ã‚¹ã€åˆæœŸåŒ–ã€çµ±åˆã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ãƒ‡ãƒãƒƒã‚°
ğŸ¤– Phase 2 (AIä¼šè©±ç¶™ç¶š): ãƒ†ãƒ¼ãƒå¤‰æ›´æ¤œå‡ºã€è³ªå•å¤‰æ›´æ¤œå‡ºã€AI Promptçµ±åˆ
ğŸ—‘ï¸ Phase 3 (å®‰å…¨å‰Šé™¤): å‰Šé™¤ã‚³ãƒãƒ³ãƒ‰æ¤œå‡ºã€å®‰å…¨ç¢ºèªã€æ•°å€¤å‰Šé™¤
ğŸ”„ å›å¸°ãƒ†ã‚¹ãƒˆ: æ—¢å­˜æ©Ÿèƒ½ä¿è­·ã€éŸ³å£°èªè­˜ã€ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã€UIæ“ä½œ
âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹: å¿œç­”æ™‚é–“ã€è² è·å®¹é‡ã€ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡ã€ä¸¦è¡Œå‡¦ç†

${successRate >= 90 ? 'âœ… Phase 4 å“è³ªä¿è¨¼è¦ä»¶é”æˆ' : 'âš ï¸ å“è³ªæ”¹å–„ãŒå¿…è¦'}
            `.trim();
        }
        
        function getQualityGrade() {
            const successRate = testStats.total > 0 ? (testStats.passed / testStats.total) : 0;
            const avgTime = testStats.testCount > 0 ? (testStats.totalResponseTime / testStats.testCount) : 999;
            
            if (successRate >= 0.95 && avgTime <= 100) return 'A+ (å„ªç§€)';
            if (successRate >= 0.90 && avgTime <= 150) return 'A (è‰¯å¥½)';
            if (successRate >= 0.85 && avgTime <= 200) return 'B (æ™®é€š)';
            if (successRate >= 0.80) return 'C (è¦æ”¹å–„)';
            return 'D (ä¸åˆæ ¼)';
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateOverallStatus('ğŸ“‹ Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆæº–å‚™å®Œäº†', 'status-ready');
            updateStats();
            addLogEntry('finalResults', 'info', 'Phase 4 çµ±åˆãƒ†ã‚¹ãƒˆã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
            addLogEntry('finalResults', 'info', 'VoiceProcessingManager ã¨ script.js ã‚’èª­ã¿è¾¼ã¿æ¸ˆã¿');
        });
    </script>
</body>
</html> 