<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ·±å €ãã‚“v2.0 ç·Šæ€¥ä¿®å¾©ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            color: #2196F3;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        .button:hover {
            background: #1976D2;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        .warning { color: #FF9800; }
        #testResults {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: 'Consolas', monospace;
            max-height: 400px;
            overflow-y: auto;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pass { background: #4CAF50; }
        .status-fail { background: #f44336; }
        .status-unknown { background: #9E9E9E; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš¨ æ·±å €ãã‚“v2.0 ç·Šæ€¥ä¿®å¾©ãƒ†ã‚¹ãƒˆ</h1>
            <p>forceStopAllActivityé–¢æ•°é™¤å»å¾Œã®çµ±åˆãƒ†ã‚¹ãƒˆ</p>
        </div>

        <div class="test-section">
            <h3>ğŸ“‹ ãƒ†ã‚¹ãƒˆæ¦‚è¦</h3>
            <p>ãƒãƒƒãƒãƒãƒ³ãƒ—è¨­è¨ˆã®<code>forceStopAllActivity</code>é–¢æ•°ã‚’å®Œå…¨é™¤å»ã—ã€æ­£ã—ã„ã‚·ã‚¹ãƒ†ãƒ ã«çµ±ä¸€ã—ãŸä¿®å¾©ã®æ¤œè¨¼ã‚’è¡Œã„ã¾ã™ã€‚</p>
            
            <h4>ä¿®æ­£å†…å®¹:</h4>
            <ul>
                <li>âœ… forceStopAllActivityé–¢æ•°ã®å®Œå…¨å‰Šé™¤</li>
                <li>âœ… SessionEndManager.stopAllActivitiesã‚’å®‰å…¨å®Ÿè£…ã«ä¿®æ­£</li>
                <li>âœ… toggleMicrophoneçµ±ä¸€çŠ¶æ…‹ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ å„ªå…ˆã«ä¿®æ­£</li>
                <li>âœ… HTMLä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³ã®ä¿®æ­£</li>
                <li>âœ… å‰Šé™¤æ©Ÿèƒ½ã®ã€Œã©ã†ãã€å¾…ã¡ã‚·ã‚¹ãƒ†ãƒ ç¢ºèª</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h3>
            <button class="button" onclick="runEmergencyTest()">ğŸš€ ç·Šæ€¥ä¿®å¾©ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
            <button class="button" onclick="openMainApp()">ğŸ”— ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªèµ·å‹•</button>
            <button class="button" onclick="clearResults()">ğŸ§¹ çµæœã‚¯ãƒªã‚¢</button>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h3>
            <div id="testStatus">
                <p class="info">ãƒ†ã‚¹ãƒˆå¾…æ©Ÿä¸­... ã€Œç·Šæ€¥ä¿®å¾©ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
            </div>
            <pre id="testResults"></pre>
        </div>

        <div class="test-section">
            <h3>ğŸ”§ ãƒ‡ãƒãƒƒã‚°æƒ…å ±</h3>
            <div id="debugInfo">
                <p><strong>ãƒ†ã‚¹ãƒˆç’°å¢ƒ:</strong></p>
                <ul>
                    <li>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ: <span id="userAgent"></span></li>
                    <li>ç¾åœ¨æ™‚åˆ»: <span id="currentTime"></span></li>
                    <li>ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼: http://localhost:8000</li>
                    <li>ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªURL: <a href="http://localhost:8000/æ·±å €ãã‚“.html" target="_blank">æ·±å €ãã‚“.html</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã®ä¾å­˜é–¢ä¿‚ã‚’èª­ã¿è¾¼ã¿ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰ -->
    <script src="app/script.js"></script>
    <script src="app/session-manager.js"></script>
    <script src="app/voice-processing-manager.js"></script>
    <script src="app/unified-state-manager.js"></script>
    <script src="emergency-fix-test.js"></script>

    <script>
        // ãƒšãƒ¼ã‚¸åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('userAgent').textContent = navigator.userAgent;
            document.getElementById('currentTime').textContent = new Date().toLocaleString('ja-JP');
            
            // ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›ã‚’ã‚­ãƒ£ãƒƒãƒã—ã¦ãƒšãƒ¼ã‚¸ã«è¡¨ç¤º
            const originalLog = console.log;
            const resultsDiv = document.getElementById('testResults');
            
            console.log = function(...args) {
                originalLog.apply(console, args);
                if (resultsDiv) {
                    resultsDiv.textContent += args.join(' ') + '\n';
                }
            };
        });

        async function runEmergencyTest() {
            const statusDiv = document.getElementById('testStatus');
            const resultsDiv = document.getElementById('testResults');
            
            statusDiv.innerHTML = '<p class="info">ğŸ”„ ç·Šæ€¥ä¿®å¾©ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</p>';
            resultsDiv.textContent = '';
            
            try {
                const results = await emergencyFixTest();
                
                // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
                const successRate = `${results.passedTests}/${results.totalTests}`;
                const statusClass = results.success ? 'success' : 'error';
                const statusIcon = results.success ? 'ğŸŸ¢' : 'ğŸ”´';
                
                statusDiv.innerHTML = `
                    <p class="${statusClass}">
                        ${statusIcon} ãƒ†ã‚¹ãƒˆå®Œäº†: ${successRate} æˆåŠŸ 
                        (å®Ÿè¡Œæ™‚é–“: ${results.duration}ms)
                    </p>
                `;
                
                // çµæœã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
                localStorage.setItem('emergencyFixTestResults', JSON.stringify(results));
                
            } catch (error) {
                statusDiv.innerHTML = `<p class="error">âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
                console.error('ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        function openMainApp() {
            window.open('http://localhost:8000/æ·±å €ãã‚“.html', '_blank');
        }

        function clearResults() {
            document.getElementById('testResults').textContent = '';
            document.getElementById('testStatus').innerHTML = '<p class="info">çµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸã€‚</p>';
        }
    </script>
</body>
</html> 