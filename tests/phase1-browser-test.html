<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 1: VoiceProcessingManager ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
        .test-container { background: white; padding: 20px; border-radius: 8px; margin: 10px 0; }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #fd7e14; }
        .info { color: #17a2b8; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; }
        button { background: #007bff; color: white; border: none; padding: 8px 16px; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        #results { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Phase 1: VoiceProcessingManager ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-container">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆåˆ¶å¾¡</h2>
        <button onclick="runAllTests()">ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
        <button onclick="clearResults()">ğŸ—‘ï¸ çµæœã‚¯ãƒªã‚¢</button>
        <button onclick="showSystemInfo()">â„¹ï¸ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</button>
    </div>

    <div class="test-container">
        <h2>ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœ</h2>
        <div id="results"></div>
    </div>

    <div class="test-container">
        <h2>ğŸ”§ æ‰‹å‹•ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰</h2>
        <pre>
// VoiceProcessingManagerå­˜åœ¨ç¢ºèª
typeof window.VoiceProcessingManager

// ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ç¢ºèª
typeof window.VoiceProcessingManagerDebug

// ãƒ‡ãƒãƒƒã‚°æƒ…å ±è¡¨ç¤º
VoiceProcessingManagerDebug.showDebugInfo()

// åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
await VoiceProcessingManagerDebug.runBasicTest()

// çµ±è¨ˆãƒªã‚»ãƒƒãƒˆ
VoiceProcessingManagerDebug.resetStats()
        </pre>
    </div>

    <!-- VoiceProcessingManagerèª­ã¿è¾¼ã¿ï¼ˆãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¨åŒã˜æ§‹æˆï¼‰ -->
    <script src="app/voice-processing-manager.js?v=1.0"></script>
    
    <!-- ç°¡æ˜“ç‰ˆscript.jsï¼ˆprocessFinalTranscripté–¢æ•°ã®ã¿ï¼‰ -->
    <script>
        // ç°¡æ˜“ç‰ˆprocessFinalTranscriptOriginalï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
        async function processFinalTranscriptOriginal(text) {
            console.log(`[Original] Processing: "${text}"`);
            return { success: true, processedText: text, timestamp: Date.now() };
        }
        
        // æ–°ã—ã„processFinalTranscripté–¢æ•°ï¼ˆãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã¨åŒã˜ï¼‰
        async function processFinalTranscript(text) {
            try {
                // VoiceProcessingManagerãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª
                if (window.VoiceProcessingManager) {
                    // VoiceProcessingManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆï¼ˆåˆå›ã®ã¿ï¼‰
                    if (!window.voiceProcessingManagerInstance) {
                        window.voiceProcessingManagerInstance = new window.VoiceProcessingManager();
                        const initialized = await window.voiceProcessingManagerInstance.initialize();
                        if (!initialized) {
                            console.warn('[VoiceProcessingManager] åˆæœŸåŒ–å¤±æ•— - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ä½¿ç”¨');
                        }
                    }
                    
                    // VoiceProcessingManagerã‚’çµŒç”±ã—ã¦å‡¦ç†
                    return await window.voiceProcessingManagerInstance.processFinalTranscript(text);
                } else {
                    console.warn('[VoiceProcessingManager] åˆ©ç”¨ä¸å¯ - å¾“æ¥å‡¦ç†ã‚’ç›´æ¥å®Ÿè¡Œ');
                    return await processFinalTranscriptOriginal(text);
                }
            } catch (error) {
                console.error('[VoiceProcessingManager] ã‚¨ãƒ©ãƒ¼:', error);
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯å¾“æ¥å‡¦ç†ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
                return await processFinalTranscriptOriginal(text);
            }
        }
    </script>

    <script>
        // ãƒ†ã‚¹ãƒˆçµæœè¡¨ç¤ºç”¨
        const results = document.getElementById('results');
        
        function logResult(level, message) {
            const timestamp = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = level;
            div.innerHTML = `[${timestamp}] <strong>${level.toUpperCase()}:</strong> ${message}`;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
            console.log(`[${level.toUpperCase()}] ${message}`);
        }
        
        function clearResults() {
            results.innerHTML = '';
        }
        
        async function runAllTests() {
            clearResults();
            logResult('info', 'ğŸš€ Phase 1 ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆé–‹å§‹');
            
            let passed = 0;
            let failed = 0;
            
            // Test 1: VoiceProcessingManagerã‚¯ãƒ©ã‚¹å­˜åœ¨ç¢ºèª
            try {
                if (typeof window.VoiceProcessingManager === 'function') {
                    logResult('success', 'âœ… VoiceProcessingManagerã‚¯ãƒ©ã‚¹å­˜åœ¨');
                    passed++;
                } else {
                    logResult('error', 'âŒ VoiceProcessingManagerã‚¯ãƒ©ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    failed++;
                }
            } catch (error) {
                logResult('error', `âŒ VoiceProcessingManagerã‚¯ãƒ©ã‚¹ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                failed++;
            }
            
            // Test 2: ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½å­˜åœ¨ç¢ºèª
            try {
                if (typeof window.VoiceProcessingManagerDebug === 'object') {
                    logResult('success', 'âœ… ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½å­˜åœ¨');
                    passed++;
                } else {
                    logResult('error', 'âŒ ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    failed++;
                }
            } catch (error) {
                logResult('error', `âŒ ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                failed++;
            }
            
            // Test 3: processFinalTranscripté–¢æ•°å‹•ä½œç¢ºèª
            try {
                const testResult = await processFinalTranscript('ãƒ†ã‚¹ãƒˆå…¥åŠ›');
                if (testResult && testResult.success) {
                    logResult('success', 'âœ… processFinalTranscripté–¢æ•°å‹•ä½œç¢ºèª');
                    passed++;
                } else {
                    logResult('warning', 'âš ï¸ processFinalTranscripté–¢æ•°ã®æˆ»ã‚Šå€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                    passed++; // å‹•ä½œã¯ã—ã¦ã„ã‚‹ã®ã§æˆåŠŸã¨ã™ã‚‹
                }
            } catch (error) {
                logResult('error', `âŒ processFinalTranscripté–¢æ•°ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                failed++;
            }
            
            // Test 4: VoiceProcessingManageråˆæœŸåŒ–ãƒ»å‹•ä½œãƒ†ã‚¹ãƒˆ
            try {
                if (window.voiceProcessingManagerInstance) {
                    const debugInfo = window.voiceProcessingManagerInstance.getDebugInfo();
                    if (debugInfo && debugInfo.initialized) {
                        logResult('success', 'âœ… VoiceProcessingManageræ­£å¸¸åˆæœŸåŒ–');
                        passed++;
                    } else {
                        logResult('warning', 'âš ï¸ VoiceProcessingManagerã®åˆæœŸåŒ–çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                        passed++; // ä¸€å¿œæˆåŠŸã¨ã™ã‚‹
                    }
                } else {
                    logResult('warning', 'âš ï¸ VoiceProcessingManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæœªä½œæˆ');
                    passed++; // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯åˆå›å‡¦ç†æ™‚ã«ä½œæˆã•ã‚Œã‚‹ã®ã§å•é¡Œãªã—
                }
            } catch (error) {
                logResult('error', `âŒ VoiceProcessingManagerå‹•ä½œãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                failed++;
            }
            
            // Test 5: ãƒ‡ãƒãƒƒã‚°é–¢æ•°å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
            try {
                if (window.VoiceProcessingManagerDebug.runBasicTest) {
                    logResult('info', 'ğŸ§ª ãƒ‡ãƒãƒƒã‚°åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...');
                    const testResults = await window.VoiceProcessingManagerDebug.runBasicTest();
                    if (Array.isArray(testResults) && testResults.length > 0) {
                        const successfulTests = testResults.filter(r => r.success).length;
                        logResult('success', `âœ… ãƒ‡ãƒãƒƒã‚°åŸºæœ¬ãƒ†ã‚¹ãƒˆå®Œäº† (${successfulTests}/${testResults.length} æˆåŠŸ)`);
                        passed++;
                    } else {
                        logResult('warning', 'âš ï¸ ãƒ‡ãƒãƒƒã‚°åŸºæœ¬ãƒ†ã‚¹ãƒˆã®çµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                        passed++;
                    }
                } else {
                    logResult('error', 'âŒ ãƒ‡ãƒãƒƒã‚°åŸºæœ¬ãƒ†ã‚¹ãƒˆé–¢æ•°ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    failed++;
                }
            } catch (error) {
                logResult('error', `âŒ ãƒ‡ãƒãƒƒã‚°åŸºæœ¬ãƒ†ã‚¹ãƒˆå¤±æ•—: ${error.message}`);
                failed++;
            }
            
            // ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼
            logResult('info', `ğŸ“Š ãƒ†ã‚¹ãƒˆå®Œäº†: æˆåŠŸ ${passed}, å¤±æ•— ${failed}`);
            
            if (failed === 0) {
                logResult('success', 'ğŸ‰ Phase 1 ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ å…¨ã¦æˆåŠŸï¼');
            } else {
                logResult('warning', `âš ï¸ ${failed}å€‹ã®ãƒ†ã‚¹ãƒˆã§å•é¡ŒãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ`);
            }
        }
        
        function showSystemInfo() {
            logResult('info', 'ğŸ“‹ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±:');
            logResult('info', `- User Agent: ${navigator.userAgent}`);
            logResult('info', `- VoiceProcessingManager: ${typeof window.VoiceProcessingManager}`);
            logResult('info', `- VoiceProcessingManagerDebug: ${typeof window.VoiceProcessingManagerDebug}`);
            logResult('info', `- processFinalTranscript: ${typeof window.processFinalTranscript}`);
            
            if (window.voiceProcessingManagerInstance) {
                const stats = window.voiceProcessingManagerInstance.getStats();
                logResult('info', `- å‡¦ç†æ¸ˆã¿ä»¶æ•°: ${stats.totalProcessed}`);
                logResult('info', `- ã‚¨ãƒ©ãƒ¼ä»¶æ•°: ${stats.errorCount}`);
                logResult('info', `- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ä»¶æ•°: ${stats.fallbackCalls}`);
            }
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«åˆæœŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
        window.addEventListener('load', function() {
            setTimeout(() => {
                logResult('info', 'ğŸ“± Page loaded - VoiceProcessingManagerèª­ã¿è¾¼ã¿ç¢ºèª');
                showSystemInfo();
            }, 100);
        });
    </script>
</body>
</html> 