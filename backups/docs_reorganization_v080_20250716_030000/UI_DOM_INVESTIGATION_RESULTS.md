# UI/DOMæ“ä½œãƒ­ã‚¸ãƒƒã‚¯è©³ç´°èª¿æŸ»çµæœ

## ğŸ“‹ èª¿æŸ»æ¦‚è¦

**èª¿æŸ»å¯¾è±¡**: `app/script.js` (7,651è¡Œ)
**èª¿æŸ»æ—¥æ™‚**: 2025å¹´7æœˆ5æ—¥ 16:10
**èª¿æŸ»ç›®çš„**: UI/DOMæ“ä½œãƒ­ã‚¸ãƒƒã‚¯ã®åˆ†é›¢æº–å‚™ã®ãŸã‚ã®è©³ç´°åˆ†æ

## ğŸ¯ åˆ†é›¢å¯¾è±¡ã®ç‰¹å®š

### 1. DOMUtilsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ (ç´„18è¡Œ)
**ç¾åœ¨ã®å®Ÿè£…å ´æ‰€**: 2081-2096è¡Œ
```javascript
const DOMUtils = {
    get: (id) => document.getElementById(id),
    getAll: (ids) => ids.reduce((acc, id) => {
        acc[id] = document.getElementById(id);
        return acc;
    }, {}),
    getVoiceElements: (character) => {
        const prefix = character === SPEAKERS.NEHORI ? 'nehori' : 'hahori';
        return {
            voice: document.getElementById(`${prefix}Voice`),
            speed: document.getElementById(`${prefix}Speed`),
            volume: document.getElementById(`${prefix}Volume`),
            prompt: document.getElementById(`${prefix}Prompt`),
            speedValue: document.getElementById(`${prefix}SpeedValue`),
            volumeValue: document.getElementById(`${prefix}VolumeValue`)
        };
    }
};
```

**ä½¿ç”¨çŠ¶æ³**: 85å›ä½¿ç”¨ï¼ˆDOMUtils.get: 78å›ã€DOMUtils.getAll: 7å›ï¼‰

### 2. åŸºæœ¬UIæ›´æ–°é–¢æ•° (ç´„200è¡Œ)

#### 2.1 ç”»é¢é·ç§»é–¢æ•°
- `hideLoginScreen()` (3301-3306è¡Œ) - ç´„6è¡Œ
- `showMainScreen()` (3309-3315è¡Œ) - ç´„6è¡Œ  
- `showLoginScreen()` (5076-5082è¡Œ) - ç´„6è¡Œ
- `hideMainScreen()` (5084-5093è¡Œ) - ç´„9è¡Œ

#### 2.2 çŠ¶æ…‹è¡¨ç¤ºæ›´æ–°é–¢æ•°
- `updateSessionStatus()` (3317-3340è¡Œ) - ç´„23è¡Œ
- `updateKnowledgeDisplay()` (3342-3368è¡Œ) - ç´„26è¡Œ
- `updateTranscriptDisplay()` (2773-2794è¡Œ) - ç´„21è¡Œ
- `updateVoiceSettingsUI()` (2199-2251è¡Œ) - ç´„52è¡Œ
- `updateAdvancedSettingsDisplay()` (2320-2336è¡Œ) - ç´„16è¡Œ

#### 2.3 UIçŠ¶æ…‹ç®¡ç†é–¢æ•°
- `update2StepUI()` (4167-4296è¡Œ) - ç´„129è¡Œï¼ˆæœ€å¤§ã®é–¢æ•°ï¼‰
- `updateApiKeyStatusDisplay()` (4644-4647è¡Œ) - ç´„3è¡Œ
- `updateKnowledgeSettingsDisplay()` (6855-6906è¡Œ) - ç´„51è¡Œ
- `updateVoiceCommandsDisplay()` (6908-6934è¡Œ) - ç´„26è¡Œ

### 3. LocalStorageæ“ä½œé–¢æ•° (ç´„120è¡Œ)

#### 3.1 APIã‚­ãƒ¼ç®¡ç†
- `saveEncryptedApiKey()` (4035-4046è¡Œ) - ç´„11è¡Œ
- `loadEncryptedApiKey()` (4048-4059è¡Œ) - ç´„11è¡Œ
- `updatePasswordHashList()` (4061-4067è¡Œ) - ç´„6è¡Œ
- `getPasswordHashList()` (4069-4072è¡Œ) - ç´„3è¡Œ
- `hasApiKeyForPassword()` (4074-4078è¡Œ) - ç´„4è¡Œ
- `getSavedApiKeyCount()` (4080-4087è¡Œ) - ç´„7è¡Œ

#### 3.2 çŠ¶æ…‹ç®¡ç†
- `saveLoginState()` (4089-4096è¡Œ) - ç´„7è¡Œ
- `loadLoginState()` (4098-4108è¡Œ) - ç´„10è¡Œ
- `clearLoginState()` (4110-4118è¡Œ) - ç´„8è¡Œ
- `saveThemeInputState()` (4120-4132è¡Œ) - ç´„12è¡Œ
- `loadThemeInputState()` (4134-4143è¡Œ) - ç´„9è¡Œ
- `clearThemeInputState()` (4145-4153è¡Œ) - ç´„8è¡Œ

#### 3.3 è¨­å®šç®¡ç†
- `saveKnowledgeSettings()` (6832-6840è¡Œ) - ç´„8è¡Œ
- `loadKnowledgeSettings()` (6842-6852è¡Œ) - ç´„10è¡Œ
- ãã®ä»–è¨­å®šä¿å­˜/èª­ã¿è¾¼ã¿é–¢æ•° (ç´„20è¡Œ)

### 4. é«˜åº¦UIæ›´æ–°é–¢æ•° (ç´„200è¡Œ)

#### 4.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†UI
- `updateSessionStartButton()` (4368-4406è¡Œ) - ç´„38è¡Œ
- `restoreApplicationState()` (4408-4465è¡Œ) - ç´„57è¡Œ
- `evaluate2StepStatus()` (4155-4165è¡Œ) - ç´„10è¡Œ

#### 4.2 ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œUI
- `focusPasswordInput()` (4298-4304è¡Œ) - ç´„6è¡Œ
- `focusThemeInput()` (4306-4313è¡Œ) - ç´„7è¡Œ
- `handleLogout()` (4315-4340è¡Œ) - ç´„25è¡Œ
- `handleThemeClear()` (4342-4366è¡Œ) - ç´„24è¡Œ

#### 4.3 ç‰¹æ®ŠUIæ©Ÿèƒ½
- `addMessageToChat()` (3370-3513è¡Œ) - ç´„143è¡Œï¼ˆæœ€å¤§ã®é–¢æ•°ï¼‰
- `handleModalBackgroundClick()` (4814-4818è¡Œ) - ç´„4è¡Œ
- `updateMicrophoneButton()` (4859-4869è¡Œ) - ç´„10è¡Œ

## ğŸ“Š ä½¿ç”¨é »åº¦åˆ†æ

### DOMæ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³
1. **DOMUtils.get()**: 78å›ä½¿ç”¨
2. **document.getElementById()**: 27å›ä½¿ç”¨ï¼ˆç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ï¼‰
3. **document.createElement()**: 3å›ä½¿ç”¨

### æœ€ã‚‚ä½¿ç”¨ã•ã‚Œã‚‹è¦ç´ ID
1. `sessionStatus` - 3å›
2. `currentTheme` - 3å›
3. `extractedKnowledge` - 3å›
4. `messagesContainer` - 3å›
5. `transcriptDisplay` - 3å›
6. `startButton` - 3å›

### LocalStorageæ“ä½œãƒ‘ã‚¿ãƒ¼ãƒ³
1. **localStorage.getItem()**: 15å›ä½¿ç”¨
2. **localStorage.setItem()**: 15å›ä½¿ç”¨
3. **localStorage.removeItem()**: 8å›ä½¿ç”¨

## ğŸ”— ä¾å­˜é–¢ä¿‚åˆ†æ

### å†…éƒ¨ä¾å­˜é–¢ä¿‚
- **DOMUtils** â†’ 85å›ã®é–¢æ•°å‘¼ã³å‡ºã—
- **showMessage** â†’ å„UIé–¢æ•°ã‹ã‚‰å‘¼ã³å‡ºã—ï¼ˆæ—¢ã«windowçµŒç”±ã§è§£æ±ºæ¸ˆã¿ï¼‰
- **AppState** â†’ å…¨UIé–¢æ•°ã§çŠ¶æ…‹å‚ç…§

### å¤–éƒ¨ä¾å­˜é–¢ä¿‚
- **window.isApiKeyConfigured** â†’ update2StepUI()ã§ä½¿ç”¨
- **window.AI_PROMPTS** â†’ è¤‡æ•°ã®é–¢æ•°ã§ä½¿ç”¨
- **window.VoiceSettings** â†’ éŸ³å£°è¨­å®šUIé–¢æ•°ã§ä½¿ç”¨

## ğŸ¯ åˆ†é›¢æˆ¦ç•¥

### Phase 1: DOMUtilsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåˆ†é›¢
- **å¯¾è±¡**: 18è¡Œ
- **å½±éŸ¿ç¯„å›²**: 85ç®‡æ‰€ã®å‚ç…§æ›´æ–°
- **ãƒªã‚¹ã‚¯**: ä½ï¼ˆå˜ç´”ãªãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°ï¼‰

### Phase 2: åŸºæœ¬UIæ›´æ–°é–¢æ•°åˆ†é›¢
- **å¯¾è±¡**: ç´„200è¡Œ
- **ä¸»è¦é–¢æ•°**: 
  - ç”»é¢é·ç§»é–¢æ•° (4å€‹ã€ç´„27è¡Œ)
  - çŠ¶æ…‹è¡¨ç¤ºæ›´æ–°é–¢æ•° (5å€‹ã€ç´„138è¡Œ)
  - UIçŠ¶æ…‹ç®¡ç†é–¢æ•° (4å€‹ã€ç´„209è¡Œ)
- **ãƒªã‚¹ã‚¯**: ä¸­ï¼ˆAppStateã¨ã®å¯†çµåˆï¼‰

### Phase 3: LocalStorageæ“ä½œé–¢æ•°åˆ†é›¢
- **å¯¾è±¡**: ç´„120è¡Œ
- **ä¸»è¦ã‚«ãƒ†ã‚´ãƒª**: APIã‚­ãƒ¼ç®¡ç†ã€çŠ¶æ…‹ç®¡ç†ã€è¨­å®šç®¡ç†
- **ãƒªã‚¹ã‚¯**: ä½ï¼ˆç‹¬ç«‹æ€§ãŒé«˜ã„ï¼‰

### Phase 4: é«˜åº¦UIæ›´æ–°é–¢æ•°åˆ†é›¢
- **å¯¾è±¡**: ç´„200è¡Œ
- **ä¸»è¦é–¢æ•°**: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†UIã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œUIã€ç‰¹æ®ŠUIæ©Ÿèƒ½
- **ãƒªã‚¹ã‚¯**: é«˜ï¼ˆè¤‡é›‘ãªä¾å­˜é–¢ä¿‚ï¼‰

## ğŸ“‹ åˆ†é›¢å¾Œã®äºˆæƒ³åŠ¹æœ

### ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå‰Šæ¸›
- **ç¾åœ¨**: 7,651è¡Œ
- **åˆ†é›¢äºˆå®š**: ç´„590è¡Œ
- **æ®‹å­˜äºˆå®š**: ç´„7,061è¡Œï¼ˆç´„7.7%å‰Šæ¸›ï¼‰

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ
```
app/
â”œâ”€â”€ script.js (7,061è¡Œ) - ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ ui-manager.js (590è¡Œ) - UI/DOMæ“ä½œ
â”œâ”€â”€ utils.js (æ—¢å­˜) - åŸºç¤ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ file-processing.js (æ—¢å­˜) - ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
â”œâ”€â”€ knowledge-management.js (æ—¢å­˜) - çŸ¥è¦‹ç®¡ç†
â””â”€â”€ api-key-setup.js (æ—¢å­˜) - APIã‚­ãƒ¼è¨­å®š
```

## âš ï¸ æ³¨æ„ç‚¹ã¨ãƒªã‚¹ã‚¯

### é«˜ãƒªã‚¹ã‚¯è¦ç´ 
1. **update2StepUI()** (129è¡Œ) - æœ€å¤§ã®é–¢æ•°ã€è¤‡é›‘ãªä¾å­˜é–¢ä¿‚
2. **addMessageToChat()** (143è¡Œ) - ãƒãƒ£ãƒƒãƒˆæ©Ÿèƒ½ã®ä¸­æ ¸
3. **restoreApplicationState()** (57è¡Œ) - åˆæœŸåŒ–ãƒ—ãƒ­ã‚»ã‚¹

### ä¸­ãƒªã‚¹ã‚¯è¦ç´ 
1. **DOMUtilså‚ç…§æ›´æ–°** (85ç®‡æ‰€) - å¤§é‡ã®å‚ç…§å¤‰æ›´
2. **AppStateä¾å­˜** - å…¨UIé–¢æ•°ãŒçŠ¶æ…‹ã‚’å‚ç…§
3. **windowçµŒç”±ã®é–¢æ•°å‘¼ã³å‡ºã—** - æ—¢å­˜ã®çµ±ä¸€æ–¹å¼

### ä½ãƒªã‚¹ã‚¯è¦ç´ 
1. **LocalStorageæ“ä½œ** - ç‹¬ç«‹æ€§ãŒé«˜ã„
2. **ç”»é¢é·ç§»é–¢æ•°** - ã‚·ãƒ³ãƒ—ãƒ«ãªå®Ÿè£…
3. **åŸºæœ¬çš„ãªDOMæ“ä½œ** - æ¨™æº–çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³

## ğŸ”§ æ¨å¥¨å®Ÿè£…æ–¹é‡

### 1. æ®µéšçš„åˆ†é›¢
1. **Phase 1**: DOMUtilsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼ˆæœ€ã‚‚å®‰å…¨ï¼‰
2. **Phase 2**: LocalStorageæ“ä½œé–¢æ•°ï¼ˆç‹¬ç«‹æ€§ãŒé«˜ã„ï¼‰
3. **Phase 3**: åŸºæœ¬UIæ›´æ–°é–¢æ•°ï¼ˆä¸­ç¨‹åº¦ã®è¤‡é›‘ã•ï¼‰
4. **Phase 4**: é«˜åº¦UIæ›´æ–°é–¢æ•°ï¼ˆæœ€ã‚‚è¤‡é›‘ï¼‰

### 2. å®‰å…¨å¯¾ç­–
- **æœ€å°é™ã®å¤‰æ›´**: 1å›ã®å¤‰æ›´ã§æœ€å¤§50è¡Œã¾ã§
- **æ®µéšçš„æ¤œè¨¼**: å„ãƒ•ã‚§ãƒ¼ã‚ºå¾Œã«ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆ
- **å®Œå…¨ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: å„æ®µéšã§Gitã‚³ãƒŸãƒƒãƒˆ
- **å¾©å…ƒè¨ˆç”»**: å•é¡Œç™ºç”Ÿæ™‚ã®å³åº§å¾©å…ƒ

### 3. å‚ç…§æ–¹å¼
- **çµ±ä¸€æ–¹å¼**: `window.UIManager.é–¢æ•°å()` å½¢å¼
- **æ—¢å­˜æ–¹å¼è¸è¥²**: showMessageç­‰ã¨åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³
- **å¾ªç’°ä¾å­˜å›é¿**: ä¸€æ–¹å‘ä¾å­˜ã®ç¶­æŒ

## ğŸ“Š æˆåŠŸåŸºæº–

### æŠ€è¡“æŒ‡æ¨™
- **ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ**: 0ä»¶
- **æ©Ÿèƒ½å‹•ä½œ**: 100%æ­£å¸¸
- **å‚ç…§æ›´æ–°**: 100%å®Œäº†
- **ä¾å­˜é–¢ä¿‚**: æ˜ç¢ºãªä¸€æ–¹å‘ä¾å­˜

### å“è³ªæŒ‡æ¨™
- **ã‚³ãƒ¼ãƒ‰åˆ†é›¢**: 590è¡Œã®æˆåŠŸåˆ†é›¢
- **ä¿å®ˆæ€§**: ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¢ƒç•Œã®æ˜ç¢ºåŒ–
- **å¯èª­æ€§**: é–¢æ•°ã®è²¬ä»»ç¯„å›²æ˜ç¢ºåŒ–
- **æ‹¡å¼µæ€§**: æ–°æ©Ÿèƒ½è¿½åŠ ã®å®¹æ˜“åŒ–

---

**èª¿æŸ»å®Œäº†**: 2025å¹´7æœˆ5æ—¥ 16:15
**æ¬¡ã‚¹ãƒ†ãƒƒãƒ—**: Phase 1 - DOMUtilsã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆåˆ†é›¢ã®å®Ÿè¡Œè¨ˆç”»ç­–å®š 